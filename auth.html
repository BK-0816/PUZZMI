
<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PUZZMI - 회원가입 / 로그인</title>
<link rel="stylesheet" href="styles.css"/><link rel="stylesheet" href="pages.css"/><link rel="stylesheet" href="pages-theme.css"/></head>
<body class="bg-cream"><main class="page"><section class="card"><h2>회원가입 / 로그인</h2>
<div class="tabs"><button class="tab" data-tab="login">로그인</button><button class="tab" data-tab="signup">회원가입</button><button class="tab" data-tab="magic">매직링크</button></div>
<form id="loginForm" data-panel="login" class="stack-16"><div class="row single"><div class="field"><div class="label">이메일</div><input class="input" id="login_email" type="email" required/></div><div class="field"><div class="label">비밀번호</div><input class="input" id="login_password" type="password" required/></div></div><button class="btn btn-primary" type="submit">로그인</button><div id="login_result"></div></form>
<form id="signupForm" data-panel="signup" class="stack-16"><div class="row"><div class="field"><div class="label">이름</div><input class="input" id="signup_name" required/></div><div class="field"><div class="label">나이</div><input class="input" id="signup_age" type="number"/></div></div><div class="row"><div class="field"><div class="label">이메일</div><input class="input" id="signup_email" type="email" required/></div><div class="field"><div class="label">비밀번호</div><input class="input" id="signup_password" type="password" minlength="6" required/></div></div><button class="btn btn-primary" type="submit">회원가입</button><div id="signup_result"></div></form>
<form id="magicForm" data-panel="magic" class="stack-16"><div class="field"><div class="label">이메일</div><input class="input" id="magic_email" type="email" required/></div><button class="btn btn-primary" type="submit">로그인 링크 보내기</button><div id="magic_result"></div></form>
<div class="spacer"></div><button id="logout" class="btn btn-secondary">로그아웃</button><div id="whoami" class="muted"></div></section></main>
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supabase = createClient("https://eevvgbbokenpjnvtmztk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVldnZnYmJva2VucGpudnRtenRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NjI2OTgsImV4cCI6MjA3MzEzODY5OH0.aLoqYYeDW_0ZEwkr8c8IPFvXnEwQPZah1mQzwiyG2Y4");
const tabs=document.querySelectorAll('.tab'); const panels=document.querySelectorAll('form[data-panel]'); function show(n){panels.forEach(p=>p.style.display=p.getAttribute('data-panel')===n?'block':'none'); tabs.forEach(t=>t.classList.toggle('active', t.dataset.tab===n));} tabs.forEach(t=>t.onclick=()=>show(t.dataset.tab)); show('login');
function getRedirect(){const u=new URL(location.href); return u.searchParams.get('redirect')||'index.html';}
document.getElementById('loginForm').onsubmit=async(e)=>{e.preventDefault(); const email=document.getElementById('login_email').value.trim(); const password=document.getElementById('login_password').value; const {error}=await supabase.auth.signInWithPassword({email,password}); document.getElementById('login_result').innerHTML= error?('<div class=error>'+error.message+'</div>'):'<div class=success>로그인 성공</div>'; if(!error) setTimeout(()=>location.href=getRedirect(),600); render();};
document.getElementById('signupForm').onsubmit=async(e)=>{e.preventDefault(); const full_name=document.getElementById('signup_name').value.trim(); const ageRaw=document.getElementById('signup_age').value; const age=ageRaw?parseInt(ageRaw,10):null; const email=document.getElementById('signup_email').value.trim(); const password=document.getElementById('signup_password').value; const {data,error}=await supabase.auth.signUp({email,password, options:{data:{full_name}}}); document.getElementById('signup_result').innerHTML= error?('<div class=error>'+error.message+'</div>'):'<div class=success>가입 완료</div>'; if(data?.user?.id){await supabase.from('profiles').upsert({id:data.user.id, full_name, age},{onConflict:'id'});} render();};
document.getElementById('magicForm').onsubmit=async(e)=>{e.preventDefault(); const email=document.getElementById('magic_email').value.trim(); const {error}=await supabase.auth.signInWithOtp({email, options:{emailRedirectTo: location.origin + '/' + getRedirect()}}); document.getElementById('magic_result').innerHTML= error?('<div class=error>'+error.message+'</div>'):'<div class=success>보냈습니다</div>';};
document.getElementById('logout').onclick=async()=>{await supabase.auth.signOut(); render();};
async function render(){const {data:{user}}=await supabase.auth.getUser(); document.getElementById('whoami').textContent= user?('로그인됨: ' + (user.email||user.id)):'로그인되지 않음';}
render();
</script></body></html>

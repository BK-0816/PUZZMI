<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PUZZMI ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="pages.css"/>
  <link rel="stylesheet" href="pages-theme.css"/>
  <link rel="stylesheet" href="nav.css"/>
  <script type="module" src="nav.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    body.bg-cream { 
      background: var(--bg-cream); 
      background-repeat: no-repeat; 
      background-size: cover; 
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    /* ë°°ê²½ ì¥ì‹ ìš”ì†Œ */
    .decorative-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    
    .decorative-element {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.2;
      animation: float 15s ease-in-out infinite;
    }
    
    .decorative-element:nth-child(1) {
      width: 300px;
      height: 300px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      top: 5%;
      left: -8%;
      animation-delay: 0s;
    }
    
    .decorative-element:nth-child(2) {
      width: 250px;
      height: 250px;
      background: linear-gradient(45deg, #f093fb, #f5576c);
      top: 40%;
      right: -10%;
      animation-delay: 5s;
    }
    
    .decorative-element:nth-child(3) {
      width: 200px;
      height: 200px;
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      bottom: 10%;
      left: 15%;
      animation-delay: 10s;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
      25% { transform: translateY(-30px) rotate(90deg) scale(1.1); }
      50% { transform: translateY(-15px) rotate(180deg) scale(0.9); }
      75% { transform: translateY(-25px) rotate(270deg) scale(1.05); }
    }
    
    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .admin-wrap { 
      max-width: 1400px; 
      margin: 32px auto; 
      padding: 0 20px;
      position: relative;
      z-index: 1;
    }
    
    /* í˜ì´ì§€ í—¤ë” */
    .page-header {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.92) 100%);
      backdrop-filter: blur(25px);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 32px;
      padding: 50px;
      margin-bottom: 40px;
      box-shadow: 0 30px 80px rgba(0,0,0,0.08), 0 12px 32px rgba(0,0,0,0.04);
      position: relative;
      overflow: hidden;
      text-align: center;
    }
    
    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 20%, #f093fb 40%, #f5576c 60%, #4facfe 80%, #00f2fe 100%);
      animation: shimmer 4s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 1; transform: translateX(0); }
      50% { opacity: 0.8; transform: translateX(10px); }
    }
    
    .page-header h2 {
      font-size: 3.2rem;
      font-weight: 900;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 20px 0;
      letter-spacing: -0.03em;
      position: relative;
    }
    
    .page-header h2::after {
      content: '';
      position: absolute;
      bottom: -16px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 5px;
      background: linear-gradient(90deg, #667eea 0%, #f093fb 50%, #4facfe 100%);
      border-radius: 3px;
    }
    
    .page-subtitle {
      font-size: 1.3rem;
      color: var(--text-secondary);
      line-height: 1.7;
      max-width: 600px;
      margin: 0 auto;
      font-weight: 500;
    }
    
    /* ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }
    
    /* í†µê³„ ì¹´ë“œ */
    .stat-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 24px;
      padding: 32px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.06), 0 6px 16px rgba(0,0,0,0.04);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      opacity: 0.8;
    }
    
    .stat-card:nth-child(1)::before {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }
    
    .stat-card:nth-child(2)::before {
      background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
    }
    
    .stat-card:nth-child(3)::before {
      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .stat-card:nth-child(4)::before {
      background: linear-gradient(90deg, #ffd700 0%, #ffb347 100%);
    }
    
    .stat-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 24px 60px rgba(0,0,0,0.12), 0 8px 24px rgba(0,0,0,0.08);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .stat-card:hover::before {
      opacity: 1;
      height: 5px;
    }
    
    .stat-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.8;
    }
    
    .stat-card:nth-child(1) .stat-icon { color: #667eea; }
    .stat-card:nth-child(2) .stat-icon { color: #f093fb; }
    .stat-card:nth-child(3) .stat-icon { color: #4facfe; }
    .stat-card:nth-child(4) .stat-icon { color: #ffd700; }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stat-label {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* ì„¹ì…˜ ì¹´ë“œ */
    .section-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 28px;
      padding: 40px;
      margin-bottom: 32px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.04);
      position: relative;
      overflow: hidden;
      transition: all 0.4s ease;
    }
    
    .section-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 33%, #f093fb 66%, #f5576c 100%);
      opacity: 0.8;
    }
    
    .section-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 32px 80px rgba(0,0,0,0.12), 0 12px 32px rgba(0,0,0,0.08);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .section-card:hover::before {
      opacity: 1;
      height: 5px;
    }
    
    /* ì„¹ì…˜ ì œëª© */
    .section-title {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 24px 0;
      letter-spacing: -0.02em;
      position: relative;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .section-title::before {
      content: '';
      width: 6px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
      border-radius: 3px;
      flex-shrink: 0;
    }
    
    /* íˆ´ë°” */
    .toolbar {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.05) 100%);
      border: 2px solid rgba(102, 126, 234, 0.15);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.1);
    }
    
    .toolbar-row {
      display: grid;
      grid-template-columns: 2fr 2fr 1fr;
      gap: 20px;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .search-group {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .search-input {
      width: 100%;
      padding: 14px 50px 14px 20px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .search-input:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.5);
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.95) 100%);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), inset 0 2px 12px rgba(0,0,0,0.06);
      transform: translateY(-1px);
    }
    
    .search-clear {
      position: absolute;
      right: 12px;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 4px;
      border-radius: 50%;
      transition: all 0.2s ease;
      font-size: 14px;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .search-clear:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }
    
    .filter-group {
      display: flex;
      gap: 12px;
    }
    
    .filter-select {
      padding: 12px 16px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      cursor: pointer;
      min-width: 140px;
    }
    
    .filter-select:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .action-group {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: flex-end;
    }
    
    .refresh-btn {
      width: 44px;
      height: 44px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .refresh-btn:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: rotate(180deg) scale(1.1);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
    }
    
    .result-count {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%);
      color: #667eea;
      padding: 8px 16px;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 700;
      border: 1px solid rgba(102, 126, 234, 0.2);
      white-space: nowrap;
    }
    
    /* í€µ í•„í„° */
    .quick-filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .quick-filter {
      padding: 8px 16px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.85rem;
      font-weight: 600;
      backdrop-filter: blur(8px);
    }
    
    .quick-filter:hover {
      border-color: rgba(102, 126, 234, 0.4);
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.9) 100%);
      transform: translateY(-1px);
    }
    
    .quick-filter.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    /* í…Œì´ë¸” */
    .table-container {
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 12px 32px rgba(0,0,0,0.08);
      border: 1px solid rgba(255,255,255,0.6);
    }
    
    .table { 
      width: 100%; 
      border-collapse: collapse; 
      background: transparent;
    }
    
    .table th {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.05) 100%);
      color: var(--text-primary);
      padding: 16px 12px;
      font-weight: 800;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid rgba(102, 126, 234, 0.2);
      text-align: center;
    }
    
    .table td {
      padding: 14px 12px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
      font-size: 0.9rem;
      font-weight: 500;
      vertical-align: middle;
      text-align: center;
    }
    
    .table tr:hover {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.03) 0%, rgba(240, 147, 251, 0.02) 100%);
    }
    
    /* ìƒíƒœ ë°°ì§€ */
    .status-badge {
      padding: 6px 12px;
      border-radius: 16px;
      font-weight: 700;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 2px solid transparent;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      min-width: 80px;
      justify-content: center;
    }
    
    .status-pending {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      color: #856404;
      border-color: rgba(255, 193, 7, 0.3);
    }
    
    .status-confirmed {
      background: linear-gradient(135deg, #d1e7dd 0%, #a3e4d7 100%);
      color: #0f5132;
      border-color: rgba(25, 135, 84, 0.3);
    }
    
    .status-completed {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .status-declined {
      background: linear-gradient(135deg, #f8d7da 0%, #f1948a 100%);
      color: #721c24;
      border-color: rgba(220, 53, 69, 0.3);
    }
    
    .status-cancelled {
      background: linear-gradient(135deg, #e2e3e5 0%, #ced4da 100%);
      color: #495057;
      border-color: rgba(108, 117, 125, 0.3);
    }
    
    /* ì¶©ëŒ í‘œì‹œ */
    .conflict {
      color: #ef4444;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .ok {
      color: #16a34a;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }
    
    /* ë²„íŠ¼ */
    .btn {
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
      color: var(--text-primary);
      border: 2px solid rgba(102, 126, 234, 0.2);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.9) 100%);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      border-color: rgba(102, 126, 234, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);
    }
    
    .btn-danger:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 16px rgba(240, 147, 251, 0.4);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
    }
    
    .btn-success:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 16px rgba(79, 172, 254, 0.4);
    }
    
    .btn-verify {
      background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
      color: #333;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }
    
    .btn-verify:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 16px rgba(255, 215, 0, 0.4);
    }
    
    /* ì…ë ¥ í•„ë“œ */
    .input {
      padding: 12px 16px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      font-size: 0.95rem;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .input:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.5);
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.95) 100%);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), inset 0 2px 12px rgba(0,0,0,0.06);
      transform: translateY(-1px);
    }
    
    /* ì•Œë¦¼ ë©”ì‹œì§€ */
    .success {
      background: linear-gradient(135deg, #d1f2eb 0%, #a3e4d7 100%);
      color: #0e6b47;
      padding: 16px 20px;
      border-radius: 16px;
      border: 2px solid rgba(25, 135, 84, 0.3);
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(25, 135, 84, 0.2);
      margin: 16px 0;
    }
    
    .error {
      background: linear-gradient(135deg, #fadbd8 0%, #f1948a 100%);
      color: #922b21;
      padding: 16px 20px;
      border-radius: 16px;
      border: 2px solid rgba(220, 53, 69, 0.3);
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(220, 53, 69, 0.2);
      margin: 16px 0;
    }
    
    .warning {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      color: #856404;
      padding: 16px 20px;
      border-radius: 16px;
      border: 2px solid rgba(255, 193, 7, 0.3);
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(255, 193, 7, 0.2);
      margin: 16px 0;
    }
    
    /* ì„¤ì • í¼ */
    .settings-form {
      display: grid;
      gap: 24px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: end;
    }
    
    .form-row.single {
      grid-template-columns: 1fr;
    }
    
    .form-field {
      position: relative;
    }
    
    .form-label {
      display: block;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 0.95rem;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* ì•¡ì…˜ ë²„íŠ¼ ê·¸ë£¹ */
    .action-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    
    /* ì‹œìŠ¤í…œ ìƒíƒœ */
    .system-status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .status-item {
      background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
      border: 2px solid rgba(255,255,255,0.4);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
    }
    
    .status-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.12);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .status-icon {
      font-size: 2rem;
      margin-bottom: 12px;
    }
    
    .status-online .status-icon { color: #28a745; }
    .status-warning .status-icon { color: #ffc107; }
    .status-error .status-icon { color: #dc3545; }
    
    .status-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    /* ë¡œê·¸ ë·°ì–´ */
    .log-viewer {
      background: #1a1a1a;
      color: #00ff00;
      font-family: 'Courier New', monospace;
      padding: 20px;
      border-radius: 12px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 0.85rem;
      line-height: 1.4;
      border: 2px solid rgba(102, 126, 234, 0.2);
    }
    
    .log-viewer::-webkit-scrollbar {
      width: 8px;
    }
    
    .log-viewer::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
    }
    
    .log-viewer::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 4px;
    }
    
    .log-entry {
      margin-bottom: 4px;
      padding: 2px 0;
    }
    
    .log-timestamp {
      color: #888;
    }
    
    .log-level-info { color: #00ff00; }
    .log-level-warn { color: #ffff00; }
    .log-level-error { color: #ff0000; }
    
    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 1024px) {
      .admin-wrap {
        padding: 0 16px;
        margin: 24px auto;
      }
      
      .page-header {
        padding: 32px;
        border-radius: 24px;
      }
      
      .page-header h2 {
        font-size: 2.5rem;
      }
      
      .dashboard-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }
      
      .section-card {
        padding: 28px;
        border-radius: 20px;
      }
      
      .toolbar-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .filter-group {
        flex-direction: column;
        gap: 12px;
      }
      
      .action-group {
        justify-content: center;
      }
    }
    
    @media (max-width: 768px) {
      .page-header h2 {
        font-size: 2rem;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .action-buttons {
        flex-direction: column;
        align-items: stretch;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
      
      .table-container {
        overflow-x: auto;
      }
      
      .system-status {
        grid-template-columns: 1fr;
      }
    }
    
    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
    .toast {
      position: fixed;
      left: 50%;
      top: 20px;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      z-index: 9999;
      font-weight: 600;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
      animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
    
    /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
    .chart-container {
      background: rgba(255,255,255,0.8);
      border-radius: 16px;
      padding: 24px;
      margin: 20px 0;
      box-shadow: 0 8px 24px rgba(0,0,0,0.06);
      border: 1px solid rgba(255,255,255,0.6);
    }
    
    /* ë©”ì´íŠ¸ ê´€ë¦¬ ì¹´ë“œ */
    .mate-management-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
    
    .mate-management-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.12);
      border-color: rgba(102, 126, 234, 0.4);
    }
    
    .mate-header {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .mate-avatar {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      object-fit: cover;
      border: 2px solid rgba(255,255,255,0.6);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .mate-info h4 {
      font-size: 1.2rem;
      font-weight: 700;
      margin: 0 0 4px 0;
      color: var(--text-primary);
    }
    
    .mate-meta {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .mate-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body class="bg-cream">
  <!-- ë°°ê²½ ì¥ì‹ ìš”ì†Œ -->
  <div class="decorative-bg">
    <div class="decorative-element"></div>
    <div class="decorative-element"></div>
    <div class="decorative-element"></div>
  </div>

  <div id="app-nav"></div>
  
  <main class="admin-wrap">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <section class="page-header">
      <h2>ğŸ› ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
      <p class="page-subtitle">PUZZMI ì„œë¹„ìŠ¤ì˜ ì „ì²´ í˜„í™©ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
      <div id="adminGuard" class="error" style="display:none; margin-top: 16px;"></div>
    </section>

    <!-- í†µê³„ ëŒ€ì‹œë³´ë“œ -->
    <section class="dashboard-grid">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-number" id="totalBookings">0</div>
        <div class="stat-label">ì´ ì˜ˆì•½</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-number" id="totalMates">0</div>
        <div class="stat-label">ë“±ë¡ ë©”ì´íŠ¸</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-number" id="totalRevenue">Â¥0</div>
        <div class="stat-label">ì´ ë§¤ì¶œ</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">â­</div>
        <div class="stat-number" id="avgRating">0.0</div>
        <div class="stat-label">í‰ê·  í‰ì </div>
      </div>
    </section>

    <!-- ì‹œìŠ¤í…œ ìƒíƒœ -->
    <section class="section-card">
      <h3 class="section-title">ğŸ”§ ì‹œìŠ¤í…œ ìƒíƒœ</h3>
      <div class="system-status">
        <div class="status-item status-online">
          <div class="status-icon">ğŸŸ¢</div>
          <div class="status-label">ë°ì´í„°ë² ì´ìŠ¤</div>
          <div class="status-value">ì •ìƒ</div>
        </div>
        <div class="status-item status-online">
          <div class="status-icon">ğŸŸ¢</div>
          <div class="status-label">ìŠ¤í† ë¦¬ì§€</div>
          <div class="status-value">ì •ìƒ</div>
        </div>
        <div class="status-item status-online">
          <div class="status-icon">ğŸŸ¢</div>
          <div class="status-label">ì•Œë¦¼ ì„œë¹„ìŠ¤</div>
          <div class="status-value">ì •ìƒ</div>
        </div>
        <div class="status-item status-online">
          <div class="status-icon">ğŸŸ¢</div>
          <div class="status-label">ê²°ì œ ì‹œìŠ¤í…œ</div>
          <div class="status-value">ì •ìƒ</div>
        </div>
      </div>
    </section>

    <!-- ì•Œë¦¼ ì„¤ì • -->
    <section class="section-card">
      <h3 class="section-title">ğŸ”” ì•Œë¦¼ ì„¤ì •</h3>
      <form class="settings-form">
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="slackWebhook">Slack Webhook URL</label>
            <input id="slackWebhook" class="input" placeholder="https://hooks.slack.com/services/..." />
          </div>
          <div class="form-field">
            <label class="form-label" for="notifyWebhook">ì¼ë°˜ Webhook URL</label>
            <input id="notifyWebhook" class="input" placeholder="https://your-webhook-url.com/notify" />
          </div>
        </div>
        
        <div class="action-buttons">
          <button id="saveSettings" class="btn btn-primary" type="button">
            <i class="fas fa-save"></i> ì„¤ì • ì €ì¥
          </button>
          <button id="testSlack" class="btn btn-secondary" type="button">
            <i class="fab fa-slack"></i> Slack í…ŒìŠ¤íŠ¸
          </button>
          <button id="testNotify" class="btn btn-secondary" type="button">
            <i class="fas fa-bell"></i> Webhook í…ŒìŠ¤íŠ¸
          </button>
        </div>
        <div id="settingsResult"></div>
      </form>
    </section>

    <!-- ë©”ì´íŠ¸ ê´€ë¦¬ -->
    <section class="section-card">
      <h3 class="section-title">ğŸ‘¥ ë©”ì´íŠ¸ ê´€ë¦¬</h3>
      
      <div class="toolbar">
        <div class="toolbar-row">
          <div class="search-group">
            <input class="search-input" id="mateSearch" type="text" placeholder="ğŸ” ë©”ì´íŠ¸ ì´ë¦„, íƒœê·¸ë¡œ ê²€ìƒ‰..."/>
            <button class="search-clear" id="clearMateSearch" title="ê²€ìƒ‰ ì´ˆê¸°í™”">âœ•</button>
          </div>
          
          <div class="filter-group">
            <select class="filter-select" id="mateVerifiedFilter">
              <option value="">ğŸ” ê²€ì¦ ìƒíƒœ: ì „ì²´</option>
              <option value="true">âœ… ê²€ì¦ë¨ë§Œ</option>
              <option value="false">â³ ë¯¸ê²€ì¦ë§Œ</option>
            </select>
            
            <select class="filter-select" id="mateSortBy">
              <option value="rating_desc">â­ í‰ì  ë†’ì€ìˆœ</option>
              <option value="rating_asc">â­ í‰ì  ë‚®ì€ìˆœ</option>
              <option value="bookings_desc">ğŸ“Š ì˜ˆì•½ ë§ì€ìˆœ</option>
              <option value="name_asc">ğŸ“ ì´ë¦„ìˆœ</option>
            </select>
          </div>
          
          <div class="action-group">
            <button class="refresh-btn" id="refreshMates" title="ë©”ì´íŠ¸ ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
            <span class="result-count" id="mateCount">ì´ 0ëª…</span>
          </div>
        </div>
        
        <div class="quick-filters">
          <button class="quick-filter active" data-mate-filter="all">ğŸ‘¥ ì „ì²´</button>
          <button class="quick-filter" data-mate-filter="verified">âœ… ê²€ì¦ë¨</button>
          <button class="quick-filter" data-mate-filter="unverified">â³ ë¯¸ê²€ì¦</button>
          <button class="quick-filter" data-mate-filter="high-rating">â­ ê³ í‰ì </button>
          <button class="quick-filter" data-mate-filter="new">ğŸ†• ì‹ ê·œ</button>
        </div>
      </div>
      
      <div id="matesList"></div>
    </section>

    <!-- ì˜ˆì•½ ê´€ë¦¬ -->
    <section class="section-card">
      <h3 class="section-title">ğŸ“‹ ì˜ˆì•½ ê´€ë¦¬</h3>
      
      <div class="toolbar">
        <div class="toolbar-row">
          <div class="search-group">
            <input class="search-input" id="bookingSearch" type="text" placeholder="ğŸ” ê³ ê°ëª…, ì—°ë½ì²˜, ë©”ì´íŠ¸ëª…ìœ¼ë¡œ ê²€ìƒ‰..."/>
            <button class="search-clear" id="clearBookingSearch" title="ê²€ìƒ‰ ì´ˆê¸°í™”">âœ•</button>
          </div>
          
          <div class="filter-group">
            <select class="filter-select" id="statusFilter">
              <option value="">ğŸ“Š ëª¨ë“  ìƒíƒœ</option>
              <option value="pending">â³ ëŒ€ê¸°ì¤‘</option>
              <option value="confirmed">âœ… í™•ì •</option>
              <option value="completed">ğŸ‰ ì™„ë£Œ</option>
              <option value="declined">âŒ ê±°ì ˆ</option>
              <option value="cancelled">ğŸš« ì·¨ì†Œ</option>
            </select>
            
            <select class="filter-select" id="dateFilter">
              <option value="">ğŸ“… ëª¨ë“  ê¸°ê°„</option>
              <option value="today">ğŸ“… ì˜¤ëŠ˜</option>
              <option value="week">ğŸ“… ì´ë²ˆì£¼</option>
              <option value="month">ğŸ“… ì´ë²ˆë‹¬</option>
            </select>
          </div>
          
          <div class="action-group">
            <button class="refresh-btn" id="refreshBookings" title="ì˜ˆì•½ ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
            <span class="result-count" id="bookingCount">ì´ 0ê±´</span>
          </div>
        </div>
        
        <div class="quick-filters">
          <button class="quick-filter active" data-booking-filter="all">ğŸ“‹ ì „ì²´</button>
          <button class="quick-filter" data-booking-filter="pending">â³ ëŒ€ê¸°ì¤‘</button>
          <button class="quick-filter" data-booking-filter="today">ğŸ“… ì˜¤ëŠ˜</button>
          <button class="quick-filter" data-booking-filter="conflicts">âš ï¸ ì¶©ëŒ</button>
          <button class="quick-filter" data-booking-filter="recent">ğŸ†• ìµœê·¼</button>
        </div>
      </div>
      
      <div class="action-buttons" style="margin-bottom: 20px;">
        <button id="checkConflicts" class="btn btn-secondary">
          <i class="fas fa-exclamation-triangle"></i> ì¶©ëŒ ì „ì²´ ì ê²€
        </button>
        <button id="exportCsv" class="btn btn-success">
          <i class="fas fa-download"></i> CSV ë‚´ë³´ë‚´ê¸°
        </button>
        <button id="autoComplete" class="btn btn-primary">
          <i class="fas fa-magic"></i> ìë™ ì™„ë£Œ ì²˜ë¦¬
        </button>
      </div>
      
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>ğŸ“‹ ID</th>
              <th>ğŸ“Š ìƒíƒœ</th>
              <th>ğŸ“… ì¼ì‹œ</th>
              <th>ğŸ‘¤ ê³ ê°</th>
              <th>ğŸ“ ì—°ë½ì²˜</th>
              <th>ğŸŒ ì–¸ì–´</th>
              <th>ğŸ‘¥ ë©”ì´íŠ¸</th>
              <th>ğŸ’­ ìš”ì²­ì‚¬í•­</th>
              <th>âš ï¸ ì¶©ëŒ</th>
              <th>ğŸ”§ ì¡°ì¹˜</th>
            </tr>
          </thead>
          <tbody id="bookingsTable"></tbody>
        </table>
      </div>
    </section>

    <!-- ì‹œìŠ¤í…œ ë¡œê·¸ -->
    <section class="section-card">
      <h3 class="section-title">ğŸ“œ ì‹œìŠ¤í…œ ë¡œê·¸</h3>
      <div class="action-buttons" style="margin-bottom: 20px;">
        <button id="refreshLogs" class="btn btn-secondary">
          <i class="fas fa-sync"></i> ë¡œê·¸ ìƒˆë¡œê³ ì¹¨
        </button>
        <button id="clearLogs" class="btn btn-danger">
          <i class="fas fa-trash"></i> ë¡œê·¸ ì§€ìš°ê¸°
        </button>
        <select id="logLevel" class="filter-select">
          <option value="">ëª¨ë“  ë ˆë²¨</option>
          <option value="info">ì •ë³´</option>
          <option value="warn">ê²½ê³ </option>
          <option value="error">ì˜¤ë¥˜</option>
        </select>
      </div>
      <div class="log-viewer" id="logViewer">
        <div class="log-entry">
          <span class="log-timestamp">[2025-01-27 10:00:00]</span>
          <span class="log-level-info">[INFO]</span>
          ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </section>
  </main>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    const SUPABASE_URL = "https://eevvgbbokenpjnvtmztk.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVldnZnYmJva2VucGpudnRtenRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NjI2OTgsImV4cCI6MjA3MzEzODY5OH0.aLoqYYeDW_0ZEwkr8c8IPFvXnEwQPZah1mQzwiyG2Y4";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // DOM ìš”ì†Œë“¤
    const adminGuard = document.getElementById('adminGuard');
    const totalBookingsEl = document.getElementById('totalBookings');
    const totalMatesEl = document.getElementById('totalMates');
    const totalRevenueEl = document.getElementById('totalRevenue');
    const avgRatingEl = document.getElementById('avgRating');
    
    const matesList = document.getElementById('matesList');
    const mateSearch = document.getElementById('mateSearch');
    const mateVerifiedFilter = document.getElementById('mateVerifiedFilter');
    const mateSortBy = document.getElementById('mateSortBy');
    const mateCount = document.getElementById('mateCount');
    
    const bookingsTable = document.getElementById('bookingsTable');
    const bookingSearch = document.getElementById('bookingSearch');
    const statusFilter = document.getElementById('statusFilter');
    const dateFilter = document.getElementById('dateFilter');
    const bookingCount = document.getElementById('bookingCount');
    
    const logViewer = document.getElementById('logViewer');
    const logLevel = document.getElementById('logLevel');

    // 1) ì ‘ê·¼ ì œì–´: ê´€ë¦¬ìë§Œ
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      adminGuard.textContent = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤â€¦";
      adminGuard.style.display = 'block';
      const redir = encodeURIComponent(location.pathname.replace(/^\//, '') + location.search);
      setTimeout(() => location.replace('auth_combo.html?redirect=' + redir), 800);
      throw new Error('login required');
    }
    
    const { data: isAdminRow } = await supabase.from('admin_users').select('user_id').eq('user_id', user.id).maybeSingle();
    if (!isAdminRow) {
      adminGuard.textContent = "ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
      adminGuard.style.display = 'block';
      throw new Error('admin required');
    }

    // 2) ìƒíƒœ ë³€ìˆ˜
    let allBookings = [];
    let filteredBookings = [];
    let allMates = [];
    let filteredMates = [];
    let matesMap = new Map();
    let systemLogs = [];

    // 3) ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    const yenFormatter = new Intl.NumberFormat('ja-JP', {
      style: 'currency',
      currency: 'JPY',
      maximumFractionDigits: 0
    });

    function toast(message) {
      const toastEl = document.createElement('div');
      toastEl.className = 'toast';
      toastEl.textContent = message;
      document.body.appendChild(toastEl);
      setTimeout(() => toastEl.remove(), 3000);
    }

    function addLog(level, message) {
      const timestamp = new Date().toLocaleString('ko-KR');
      const logEntry = {
        timestamp,
        level,
        message
      };
      systemLogs.unshift(logEntry);
      
      // ìµœëŒ€ 100ê°œ ë¡œê·¸ë§Œ ìœ ì§€
      if (systemLogs.length > 100) {
        systemLogs = systemLogs.slice(0, 100);
      }
      
      updateLogViewer();
    }

    function updateLogViewer() {
      const selectedLevel = logLevel.value;
      const filteredLogs = selectedLevel ? 
        systemLogs.filter(log => log.level === selectedLevel) : 
        systemLogs;
      
      logViewer.innerHTML = filteredLogs.map(log => `
        <div class="log-entry">
          <span class="log-timestamp">[${log.timestamp}]</span>
          <span class="log-level-${log.level}">[${log.level.toUpperCase()}]</span>
          ${log.message}
        </div>
      `).join('');
      
      // ìë™ ìŠ¤í¬ë¡¤
      logViewer.scrollTop = 0;
    }

    function keyToUrl(key) {
      if (!key) return 'https://picsum.photos/seed/puzzmi/60/60';
      if (/^https?:\/\//i.test(key)) return key;
      const pure = key.startsWith('mates/') ? key.replace(/^mates\//, '') : key;
      return supabase.storage.from('mates').getPublicUrl(pure).data.publicUrl;
    }

    // 4) í†µê³„ ì—…ë°ì´íŠ¸
    async function updateDashboardStats() {
      try {
        // ì˜ˆì•½ í†µê³„
        const { data: bookings, error: bookingsError } = await supabase
          .from('bookings')
          .select('id, status, total_amount, price_total, amount');
        
        if (bookingsError) throw bookingsError;
        
        const totalBookings = bookings?.length || 0;
        totalBookingsEl.textContent = totalBookings;
        
        // ë§¤ì¶œ ê³„ì‚°
        const revenue = bookings?.reduce((sum, booking) => {
          const amount = booking.total_amount || booking.price_total || booking.amount || 0;
          return sum + amount;
        }, 0) || 0;
        totalRevenueEl.textContent = yenFormatter.format(revenue);
        
        // ë©”ì´íŠ¸ ìˆ˜
        const { count: mateCount, error: mateCountError } = await supabase
          .from('mate_profiles')
          .select('user_id', { count: 'exact', head: true });
        
        if (!mateCountError) {
          totalMatesEl.textContent = mateCount || 0;
        }
        
        // í‰ê·  í‰ì 
        const { data: ratings, error: ratingsError } = await supabase
          .from('reviews')
          .select('rating');
        
        if (!ratingsError && ratings?.length) {
          const avgRating = ratings.reduce((sum, r) => sum + (r.rating || 0), 0) / ratings.length;
          avgRatingEl.textContent = avgRating.toFixed(1);
        }
        
        addLog('info', `ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ì˜ˆì•½ ${totalBookings}ê±´, ë§¤ì¶œ ${yenFormatter.format(revenue)}`);
        
      } catch (error) {
        console.error('í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
        addLog('error', `í†µê³„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // 5) ë©”ì´íŠ¸ ê´€ë¦¬
    async function loadMates() {
      try {
        matesList.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);"><div class="loading" style="margin: 0 auto 16px;"></div>ë©”ì´íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
        
        const { data, error } = await supabase
          .from('mate_profiles')
          .select(`
            user_id, is_verified, rating, tags, areas, bio, photos, primary_photo, created_at,
            profiles!inner ( id, full_name, age, gender, languages, avatar_url )
          `)
          .order('rating', { ascending: false })
          .limit(100);

        if (error) throw error;

        allMates = data || [];
        
        // ë©”ì´íŠ¸ ë§µ ì—…ë°ì´íŠ¸
        matesMap = new Map(allMates.map(mate => [
          mate.user_id, 
          mate.profiles?.full_name || 'ì´ë¦„ì—†ìŒ'
        ]));
        
        applyMateFilters();
        addLog('info', `ë©”ì´íŠ¸ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${allMates.length}ëª…`);
        
      } catch (error) {
        console.error('ë©”ì´íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
        matesList.innerHTML = `<div class="error">âŒ ë©”ì´íŠ¸ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
        addLog('error', `ë©”ì´íŠ¸ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    function applyMateFilters() {
      const searchTerm = (mateSearch?.value || '').toLowerCase();
      const verifiedFilter = mateVerifiedFilter?.value || '';
      const sortOption = mateSortBy?.value || 'rating_desc';

      // ê²€ì¦ ìƒíƒœ í•„í„°ë§
      filteredMates = allMates.filter(mate => {
        if (verifiedFilter === 'true') return mate.is_verified === true;
        if (verifiedFilter === 'false') return mate.is_verified !== true;
        return true;
      });

      // ê²€ìƒ‰ì–´ í•„í„°ë§
      if (searchTerm) {
        filteredMates = filteredMates.filter(mate => {
          const name = (mate.profiles?.full_name || '').toLowerCase();
          const tags = (Array.isArray(mate.tags) ? mate.tags.join(' ') : '').toLowerCase();
          const areas = (Array.isArray(mate.areas) ? mate.areas.join(' ') : '').toLowerCase();
          return name.includes(searchTerm) || tags.includes(searchTerm) || areas.includes(searchTerm);
        });
      }

      // ì •ë ¬
      filteredMates.sort((a, b) => {
        switch (sortOption) {
          case 'rating_desc':
            return (b.rating || 0) - (a.rating || 0);
          case 'rating_asc':
            return (a.rating || 0) - (b.rating || 0);
          case 'name_asc':
            const aName = a.profiles?.full_name || '';
            const bName = b.profiles?.full_name || '';
            return aName.localeCompare(bName);
          default:
            return (b.rating || 0) - (a.rating || 0);
        }
      });

      renderMates();
    }

    function renderMates() {
      mateCount.textContent = `ì´ ${filteredMates.length}ëª…`;
      
      if (!filteredMates.length) {
        matesList.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">ğŸ” ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë©”ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }

      matesList.innerHTML = filteredMates.map(mate => {
        const p = mate.profiles || {};
        const coverPhoto = mate.primary_photo || 
                          (Array.isArray(mate.photos) && mate.photos[0]) || 
                          p.avatar_url;
        const img = keyToUrl(coverPhoto);
        const name = p.full_name || 'ì´ë¦„ì—†ìŒ';
        const age = p.age ? `${p.age}ì„¸` : '';
        const gender = p.gender || '';
        const rating = mate.rating ?? 0;
        const createdAt = new Date(mate.created_at).toLocaleDateString('ko-KR');

        return `
          <div class="mate-management-card">
            <div class="mate-header">
              <img class="mate-avatar" src="${img}" alt="avatar"/>
              <div class="mate-info">
                <h4>${name}</h4>
                <div class="mate-meta">${[age, gender].filter(Boolean).join(' â€¢ ') || 'ì •ë³´ ë¯¸ê¸°ì¬'} â€¢ â­ ${rating.toFixed(1)} â€¢ ê°€ì…: ${createdAt}</div>
              </div>
              <div style="margin-left: auto;">
                <span class="status-badge ${mate.is_verified ? 'status-confirmed' : 'status-pending'}">
                  ${mate.is_verified ? 'âœ… ê²€ì¦ë¨' : 'â³ ë¯¸ê²€ì¦'}
                </span>
              </div>
            </div>
            <div class="mate-actions">
              <a class="btn btn-secondary" href="mate_like.html?mate_id=${mate.user_id}" target="_blank">
                <i class="fas fa-eye"></i> í”„ë¡œí•„ ë³´ê¸°
              </a>
              <a class="btn btn-secondary" href="admin_mates.html" target="_blank">
                <i class="fas fa-chart-line"></i> ìƒì„¸ ê´€ë¦¬
              </a>
              <button class="btn ${mate.is_verified ? 'btn-danger' : 'btn-success'}" data-action="toggle-verify" data-id="${mate.user_id}">
                <i class="fas ${mate.is_verified ? 'fa-times' : 'fa-check'}"></i>
                ${mate.is_verified ? 'ê²€ì¦ í•´ì œ' : 'ê²€ì¦ ì²˜ë¦¬'}
              </button>
            </div>
          </div>
        `;
      }).join('');

      // ì´ë²¤íŠ¸ ë°”ì¸ë”©
      matesList.querySelectorAll('[data-action="toggle-verify"]').forEach(btn => {
        btn.addEventListener('click', () => toggleMateVerification(btn.getAttribute('data-id')));
      });
    }

    async function toggleMateVerification(mateId) {
      const mate = allMates.find(m => m.user_id === mateId);
      if (!mate) return;
      
      const newStatus = !mate.is_verified;
      const confirmMsg = newStatus ? 
        'ì´ ë©”ì´íŠ¸ë¥¼ ê²€ì¦ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?' : 
        'ì´ ë©”ì´íŠ¸ì˜ ê²€ì¦ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
      
      if (!confirm(confirmMsg)) return;

      try {
        const { error } = await supabase
          .from('mate_profiles')
          .update({ is_verified: newStatus })
          .eq('user_id', mateId);
        
        if (error) throw error;
        
        mate.is_verified = newStatus;
        toast(newStatus ? 'âœ… ê²€ì¦ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!' : 'âŒ ê²€ì¦ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
        addLog('info', `ë©”ì´íŠ¸ ${mate.profiles?.full_name || mateId} ê²€ì¦ ìƒíƒœ ë³€ê²½: ${newStatus ? 'ê²€ì¦ë¨' : 'ë¯¸ê²€ì¦'}`);
        applyMateFilters();
        
      } catch (error) {
        console.error('ê²€ì¦ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:', error);
        toast('âŒ ê²€ì¦ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + error.message);
        addLog('error', `ë©”ì´íŠ¸ ê²€ì¦ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // 6) ì˜ˆì•½ ê´€ë¦¬
    async function loadBookings() {
      try {
        bookingsTable.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: var(--text-secondary);"><div class="loading" style="margin: 0 auto 16px;"></div>ì˜ˆì•½ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>';
        
        const { data, error } = await supabase
          .from('bookings')
          .select('*')
          .order('created_at', { ascending: false })
          .limit(500);

        if (error) throw error;

        allBookings = data || [];
        applyBookingFilters();
        addLog('info', `ì˜ˆì•½ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${allBookings.length}ê±´`);
        
      } catch (error) {
        console.error('ì˜ˆì•½ ë¡œë“œ ì‹¤íŒ¨:', error);
        bookingsTable.innerHTML = `<tr><td colspan="10" class="error">âŒ ì˜ˆì•½ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</td></tr>`;
        addLog('error', `ì˜ˆì•½ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    function applyBookingFilters() {
      const searchTerm = (bookingSearch?.value || '').toLowerCase();
      const statusFilterValue = statusFilter?.value || '';
      const dateFilterValue = dateFilter?.value || '';

      filteredBookings = [...allBookings];

      // ê²€ìƒ‰ í•„í„°ë§
      if (searchTerm) {
        filteredBookings = filteredBookings.filter(booking => {
          const customerName = (booking.customer_name || '').toLowerCase();
          const customerContact = (booking.customer_contact || '').toLowerCase();
          const mateName = (matesMap.get(booking.mate_id) || '').toLowerCase();
          
          return customerName.includes(searchTerm) || 
                 customerContact.includes(searchTerm) || 
                 mateName.includes(searchTerm);
        });
      }

      // ìƒíƒœ í•„í„°ë§
      if (statusFilterValue) {
        filteredBookings = filteredBookings.filter(booking => booking.status === statusFilterValue);
      }

      // ë‚ ì§œ í•„í„°ë§
      if (dateFilterValue) {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        
        filteredBookings = filteredBookings.filter(booking => {
          if (!booking.date) return false;
          const bookingDate = new Date(booking.date);
          
          switch (dateFilterValue) {
            case 'today':
              return bookingDate.toDateString() === today.toDateString();
            case 'week':
              const weekStart = new Date(today);
              weekStart.setDate(today.getDate() - today.getDay());
              const weekEnd = new Date(weekStart);
              weekEnd.setDate(weekStart.getDate() + 6);
              return bookingDate >= weekStart && bookingDate <= weekEnd;
            case 'month':
              return bookingDate.getMonth() === today.getMonth() && 
                     bookingDate.getFullYear() === today.getFullYear();
            default:
              return true;
          }
        });
      }

      renderBookings();
    }

    function renderBookings() {
      bookingCount.textContent = `ì´ ${filteredBookings.length}ê±´`;
      
      if (!filteredBookings.length) {
        bookingsTable.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: var(--text-secondary);">ğŸ“­ ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }

      bookingsTable.innerHTML = filteredBookings.map(booking => {
        const mateName = matesMap.get(booking.mate_id) || booking.mate_id;
        const datetime = booking.date && booking.start_time ? 
          `${booking.date} ${booking.start_time} (${booking.duration_hours || 0}h)` : 
          'ë‚ ì§œ ë¯¸ì •';
        
        const hasConflict = checkBookingConflict(booking);
        const statusClass = `status-${booking.status}`;
        const statusText = booking.status === 'pending' ? 'â³ ëŒ€ê¸°ì¤‘' :
                          booking.status === 'confirmed' ? 'âœ… í™•ì •' :
                          booking.status === 'completed' ? 'ğŸ‰ ì™„ë£Œ' :
                          booking.status === 'declined' ? 'âŒ ê±°ì ˆ' :
                          booking.status === 'cancelled' ? 'ğŸš« ì·¨ì†Œ' : booking.status;

        return `
          <tr data-id="${booking.id}">
            <td>#${booking.id}</td>
            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
            <td>${datetime}</td>
            <td>${booking.customer_name || 'ê³ ê°'}</td>
            <td>${booking.customer_contact || '-'}</td>
            <td>${booking.language || '-'}</td>
            <td>${mateName}</td>
            <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;" title="${booking.notes || ''}">${(booking.notes || '').substring(0, 30)}${(booking.notes || '').length > 30 ? '...' : ''}</td>
            <td>
              ${hasConflict ? 
                '<span class="conflict"><span class="badge-dot" style="background:#ef4444"></span>ì¶©ëŒ</span>' : 
                '<span class="ok"><span class="badge-dot" style="background:#16a34a"></span>ì •ìƒ</span>'
              }
            </td>
            <td>
              <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                ${['confirmed', 'completed', 'declined', 'cancelled'].map(status => `
                  <button class="btn btn-secondary" data-action="set-status" data-status="${status}" data-id="${booking.id}" style="font-size: 0.7rem; padding: 4px 8px;">
                    ${status === 'confirmed' ? 'âœ…' : status === 'completed' ? 'ğŸ‰' : status === 'declined' ? 'âŒ' : 'ğŸš«'}
                  </button>
                `).join('')}
                <button class="btn btn-verify" data-action="send-payment" data-id="${booking.id}" style="font-size: 0.7rem; padding: 4px 8px;">
                  <span>ğŸ’³</span>
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');

      // ìƒíƒœ ë³€ê²½ ë²„íŠ¼ ì´ë²¤íŠ¸
      bookingsTable.querySelectorAll('[data-action="set-status"]').forEach(btn => {
        btn.addEventListener('click', () => changeBookingStatus(
          btn.getAttribute('data-id'),
          btn.getAttribute('data-status')
        ));
      });

      // ê²°ì œ ìš”ì²­ ë²„íŠ¼ ì´ë²¤íŠ¸
      bookingsTable.querySelectorAll('[data-action="send-payment"]').forEach(btn => {
        btn.addEventListener('click', () => sendPaymentRequest(btn.getAttribute('data-id')));
      });
    }

    function checkBookingConflict(booking) {
      if (!booking.date || !booking.start_time || booking.status !== 'confirmed') return false;
      
      const startTime = new Date(`${booking.date}T${booking.start_time}`);
      const endTime = new Date(startTime.getTime() + (booking.duration_hours || 0) * 60 * 60 * 1000);
      
      return allBookings.some(other => {
        if (other.id === booking.id || other.mate_id !== booking.mate_id || other.status !== 'confirmed') {
          return false;
        }
        
        if (!other.date || !other.start_time) return false;
        
        const otherStart = new Date(`${other.date}T${other.start_time}`);
        const otherEnd = new Date(otherStart.getTime() + (other.duration_hours || 0) * 60 * 60 * 1000);
        
        return startTime < otherEnd && otherStart < endTime;
      });
    }

    async function changeBookingStatus(bookingId, newStatus) {
      const booking = allBookings.find(b => b.id == bookingId);
      if (!booking) return;
      
      // í™•ì • ì‹œ ì¶©ëŒ ì²´í¬
      if (['confirmed', 'completed'].includes(newStatus)) {
        if (checkBookingConflict({ ...booking, status: newStatus })) {
          if (!confirm('ë™ì‹œê°„ëŒ€ í™•ì • ê±´ì´ ìˆìŠµë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?')) return;
        }
      }

      try {
        const { error } = await supabase
          .from('bookings')
          .update({ status: newStatus })
          .eq('id', bookingId);

        if (error) throw error;

        // ë¡œì»¬ ë°ì´í„° ì—…ë°ì´íŠ¸
        booking.status = newStatus;
        
        toast(`âœ… ì˜ˆì•½ #${bookingId} ìƒíƒœê°€ ${newStatus}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`);
        addLog('info', `ì˜ˆì•½ #${bookingId} ìƒíƒœ ë³€ê²½: ${newStatus}`);
        
        // í™•ì • ì‹œ ì•Œë¦¼ ë°œì†¡
        if (newStatus === 'confirmed') {
          await sendNotification(booking);
        }
        
        applyBookingFilters();
        await updateDashboardStats();
        
      } catch (error) {
        console.error('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:', error);
        toast('âŒ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + error.message);
        addLog('error', `ì˜ˆì•½ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // ê²°ì œ ìš”ì²­ ë°œì†¡
    async function sendPaymentRequest(bookingId) {
      try {
        const reason = prompt('ê²°ì œ ìš”ì²­ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì¶”ê°€ ë©”ì‹œì§€ê°€ ìˆë‹¤ë©´ ì…ë ¥í•´ì£¼ì„¸ìš”:');
        if (reason === null) return; // ì·¨ì†Œ
        
        // LINE ê²°ì œ ì„œë¹„ìŠ¤ ë™ì  import
        const { sendPaymentRequestToCustomer } = await import('./line_payment_service.js');
        
        const result = await sendPaymentRequestToCustomer(bookingId);
        
        if (result.success) {
          toast('ğŸ’³ ê²°ì œ ìš”ì²­ì´ ê³ ê°ì˜ LINEìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          await loadBookings(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        }
        
      } catch (error) {
        console.error('ê²°ì œ ìš”ì²­ ë°œì†¡ ì‹¤íŒ¨:', error);
        toast('âŒ ê²°ì œ ìš”ì²­ ë°œì†¡ ì‹¤íŒ¨: ' + error.message);
      }
    }

    // 7) ì•Œë¦¼ ë°œì†¡
    async function sendNotification(booking) {
      try {
        const slackUrl = localStorage.getItem('puzzmi.slackWebhook') || '';
        const webhookUrl = localStorage.getItem('puzzmi.notifyWebhook') || '';
        
        const mateName = matesMap.get(booking.mate_id) || booking.mate_id;
        const message = [
          '*PUZZMI ì˜ˆì•½ í™•ì •*',
          `â€¢ ë©”ì´íŠ¸: ${mateName}`,
          `â€¢ ì¼ì‹œ: ${booking.date} ${booking.start_time} (${booking.duration_hours}h)`,
          `â€¢ ê³ ê°: ${booking.customer_name}`,
          `â€¢ ì—°ë½ì²˜: ${booking.customer_contact}`,
          booking.language ? `â€¢ ì–¸ì–´: ${booking.language}` : null,
          booking.notes ? `â€¢ ìš”ì²­: ${booking.notes}` : null,
          `â€¢ ì˜ˆì•½ID: ${booking.id}`
        ].filter(Boolean).join('\n');

        // Slack ì•Œë¦¼
        if (slackUrl) {
          fetch(slackUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: message })
          }).catch(err => console.warn('Slack ì•Œë¦¼ ì‹¤íŒ¨:', err));
        }

        // ì¼ë°˜ Webhook ì•Œë¦¼
        if (webhookUrl) {
          fetch(webhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'booking_confirmed',
              source: 'puzzmi-admin',
              data: booking
            })
          }).catch(err => console.warn('Webhook ì•Œë¦¼ ì‹¤íŒ¨:', err));
        }
        
        addLog('info', `ì˜ˆì•½ í™•ì • ì•Œë¦¼ ë°œì†¡: ${booking.id}`);
        
      } catch (error) {
        console.error('ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨:', error);
        addLog('error', `ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // 8) ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    
    // ì„¤ì • ì €ì¥
    document.getElementById('saveSettings').addEventListener('click', () => {
      const slackUrl = document.getElementById('slackWebhook').value.trim();
      const webhookUrl = document.getElementById('notifyWebhook').value.trim();
      
      localStorage.setItem('puzzmi.slackWebhook', slackUrl);
      localStorage.setItem('puzzmi.notifyWebhook', webhookUrl);
      
      document.getElementById('settingsResult').innerHTML = '<div class="success">âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
      addLog('info', 'ì•Œë¦¼ ì„¤ì • ì €ì¥ ì™„ë£Œ');
      
      setTimeout(() => {
        document.getElementById('settingsResult').innerHTML = '';
      }, 3000);
    });

    // Slack í…ŒìŠ¤íŠ¸
    document.getElementById('testSlack').addEventListener('click', async () => {
      const url = localStorage.getItem('puzzmi.slackWebhook') || '';
      if (!url) {
        toast('âŒ Slack Webhook URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
        return;
      }
      
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: ':white_check_mark: PUZZMI ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤!' })
        });
        
        if (response.ok) {
          toast('âœ… Slack í…ŒìŠ¤íŠ¸ ì„±ê³µ!');
          addLog('info', 'Slack í…ŒìŠ¤íŠ¸ ì„±ê³µ');
        } else {
          toast(`âŒ Slack í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${response.status}`);
          addLog('error', `Slack í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${response.status}`);
        }
      } catch (error) {
        toast('âŒ Slack í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message);
        addLog('error', `Slack í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
      }
    });

    // Webhook í…ŒìŠ¤íŠ¸
    document.getElementById('testNotify').addEventListener('click', async () => {
      const url = localStorage.getItem('puzzmi.notifyWebhook') || '';
      if (!url) {
        toast('âŒ Webhook URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
        return;
      }
      
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            type: 'test',
            source: 'puzzmi-admin',
            message: 'PUZZMI ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸',
            timestamp: Date.now()
          })
        });
        
        if (response.ok) {
          toast('âœ… Webhook í…ŒìŠ¤íŠ¸ ì„±ê³µ!');
          addLog('info', 'Webhook í…ŒìŠ¤íŠ¸ ì„±ê³µ');
        } else {
          toast(`âŒ Webhook í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${response.status}`);
          addLog('error', `Webhook í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${response.status}`);
        }
      } catch (error) {
        toast('âŒ Webhook í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message);
        addLog('error', `Webhook í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
      }
    });

    // ì¶©ëŒ ì ê²€
    document.getElementById('checkConflicts').addEventListener('click', () => {
      const conflicts = allBookings.filter(booking => checkBookingConflict(booking));
      
      if (conflicts.length === 0) {
        toast('âœ… ì¶©ëŒí•˜ëŠ” ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤!');
        addLog('info', 'ì˜ˆì•½ ì¶©ëŒ ì ê²€ ì™„ë£Œ: ì¶©ëŒ ì—†ìŒ');
      } else {
        toast(`âš ï¸ ${conflicts.length}ê±´ì˜ ì¶©ëŒì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤`);
        addLog('warn', `ì˜ˆì•½ ì¶©ëŒ ë°œê²¬: ${conflicts.length}ê±´`);
        
        // ì¶©ëŒ ì˜ˆì•½ë§Œ í‘œì‹œ
        filteredBookings = conflicts;
        renderBookings();
      }
    });

    // CSV ë‚´ë³´ë‚´ê¸°
    document.getElementById('exportCsv').addEventListener('click', () => {
      if (!filteredBookings.length) {
        toast('âŒ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
        return;
      }

      const headers = ['ì˜ˆì•½ID', 'ìƒíƒœ', 'ë‚ ì§œ', 'ì‹œì‘ì‹œê°„', 'ì´ìš©ì‹œê°„', 'ê³ ê°ëª…', 'ì—°ë½ì²˜', 'ì–¸ì–´', 'ë©”ì´íŠ¸', 'ìš”ì²­ì‚¬í•­', 'ìƒì„±ì¼'];
      const csvData = [
        headers.join(','),
        ...filteredBookings.map(booking => {
          const values = [
            booking.id || '',
            booking.status || '',
            booking.date || '',
            booking.start_time || '',
            booking.duration_hours || '',
            booking.customer_name || '',
            booking.customer_contact || '',
            booking.language || '',
            matesMap.get(booking.mate_id) || booking.mate_id,
            (booking.notes || '').replace(/"/g, '""'),
            new Date(booking.created_at).toLocaleString('ko-KR')
          ];
          return values.map(v => `"${v}"`).join(',');
        })
      ].join('\n');

      const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `puzzmi_bookings_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      toast('ğŸ“Š CSV íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
      addLog('info', `CSV ë‚´ë³´ë‚´ê¸° ì™„ë£Œ: ${filteredBookings.length}ê±´`);
    });

    // ìë™ ì™„ë£Œ ì²˜ë¦¬
    document.getElementById('autoComplete').addEventListener('click', async () => {
      if (!confirm('ê³¼ê±° ì˜ˆì•½ë“¤ì„ ìë™ìœ¼ë¡œ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const now = new Date();
        const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        
        const { data: toComplete, error: selectError } = await supabase
          .from('bookings')
          .select('id, date, start_time, duration_hours')
          .eq('status', 'confirmed')
          .lt('date', yesterdayStr);
        
        if (selectError) throw selectError;
        
        if (!toComplete || toComplete.length === 0) {
          toast('â„¹ï¸ ìë™ ì™„ë£Œ ì²˜ë¦¬í•  ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤');
          return;
        }
        
        const { error: updateError } = await supabase
          .from('bookings')
          .update({ status: 'completed' })
          .eq('status', 'confirmed')
          .lt('date', yesterdayStr);
        
        if (updateError) throw updateError;
        
        toast(`âœ… ${toComplete.length}ê±´ì˜ ì˜ˆì•½ì´ ìë™ ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤`);
        addLog('info', `ìë™ ì™„ë£Œ ì²˜ë¦¬: ${toComplete.length}ê±´`);
        
        await loadBookings();
        await updateDashboardStats();
        
      } catch (error) {
        console.error('ìë™ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        toast('âŒ ìë™ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message);
        addLog('error', `ìë™ ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨: ${error.message}`);
      }
    });

    // ê²€ìƒ‰ ë° í•„í„° ì´ë²¤íŠ¸
    let mateSearchTimeout, bookingSearchTimeout;
    
    mateSearch?.addEventListener('input', () => {
      clearTimeout(mateSearchTimeout);
      mateSearchTimeout = setTimeout(applyMateFilters, 300);
    });
    
    bookingSearch?.addEventListener('input', () => {
      clearTimeout(bookingSearchTimeout);
      bookingSearchTimeout = setTimeout(applyBookingFilters, 300);
    });
    
    document.getElementById('clearMateSearch')?.addEventListener('click', () => {
      mateSearch.value = '';
      applyMateFilters();
    });
    
    document.getElementById('clearBookingSearch')?.addEventListener('click', () => {
      bookingSearch.value = '';
      applyBookingFilters();
    });
    
    mateVerifiedFilter?.addEventListener('change', applyMateFilters);
    mateSortBy?.addEventListener('change', applyMateFilters);
    statusFilter?.addEventListener('change', applyBookingFilters);
    dateFilter?.addEventListener('change', applyBookingFilters);
    
    document.getElementById('refreshMates')?.addEventListener('click', async () => {
      document.getElementById('refreshMates').style.transform = 'rotate(360deg)';
      await loadMates();
      setTimeout(() => {
        document.getElementById('refreshMates').style.transform = '';
      }, 300);
    });
    
    document.getElementById('refreshBookings')?.addEventListener('click', async () => {
      document.getElementById('refreshBookings').style.transform = 'rotate(360deg)';
      await loadBookings();
      setTimeout(() => {
        document.getElementById('refreshBookings').style.transform = '';
      }, 300);
    });

    // í€µ í•„í„° ì´ë²¤íŠ¸
    document.querySelectorAll('[data-mate-filter]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-mate-filter]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const filter = btn.getAttribute('data-mate-filter');
        const now = new Date();
        const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        
        switch (filter) {
          case 'all':
            filteredMates = [...allMates];
            break;
          case 'verified':
            filteredMates = allMates.filter(mate => mate.is_verified === true);
            break;
          case 'unverified':
            filteredMates = allMates.filter(mate => mate.is_verified !== true);
            break;
          case 'high-rating':
            filteredMates = allMates.filter(mate => (mate.rating || 0) >= 4.0);
            break;
          case 'new':
            filteredMates = allMates.filter(mate => new Date(mate.created_at) >= thirtyDaysAgo);
            break;
          default:
            filteredMates = [...allMates];
        }
        
        renderMates();
      });
    });

    document.querySelectorAll('[data-booking-filter]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-booking-filter]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const filter = btn.getAttribute('data-booking-filter');
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const todayStr = today.toISOString().split('T')[0];
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        
        switch (filter) {
          case 'all':
            filteredBookings = [...allBookings];
            break;
          case 'pending':
            filteredBookings = allBookings.filter(booking => booking.status === 'pending');
            break;
          case 'today':
            filteredBookings = allBookings.filter(booking => booking.date === todayStr);
            break;
          case 'conflicts':
            filteredBookings = allBookings.filter(booking => checkBookingConflict(booking));
            break;
          case 'recent':
            filteredBookings = allBookings.filter(booking => new Date(booking.created_at) >= weekAgo);
            break;
          default:
            filteredBookings = [...allBookings];
        }
        
        renderBookings();
      });
    });

    // ë¡œê·¸ ê´€ë ¨ ì´ë²¤íŠ¸
    logLevel?.addEventListener('change', updateLogViewer);
    
    document.getElementById('refreshLogs')?.addEventListener('click', () => {
      addLog('info', 'ë¡œê·¸ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰');
      updateLogViewer();
    });
    
    document.getElementById('clearLogs')?.addEventListener('click', () => {
      if (confirm('ëª¨ë“  ë¡œê·¸ë¥¼ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        systemLogs = [];
        updateLogViewer();
        addLog('info', 'ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
      }
    });

    // 9) ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
    const bookingChannel = supabase
      .channel('admin-bookings')
      .on('postgres_changes', {
        event: '*',
        schema: 'public',
        table: 'bookings'
      }, async (payload) => {
        addLog('info', `ì‹¤ì‹œê°„ ì˜ˆì•½ ì—…ë°ì´íŠ¸: ${payload.eventType} - ID ${payload.new?.id || payload.old?.id}`);
        
        if (payload.eventType === 'INSERT') {
          allBookings.unshift(payload.new);
        } else if (payload.eventType === 'UPDATE') {
          const index = allBookings.findIndex(b => b.id === payload.new.id);
          if (index >= 0) {
            allBookings[index] = payload.new;
          }
        } else if (payload.eventType === 'DELETE') {
          allBookings = allBookings.filter(b => b.id !== payload.old.id);
        }
        
        applyBookingFilters();
        await updateDashboardStats();
      })
      .subscribe();

    // 10) ì´ˆê¸°í™”
    async function initialize() {
      try {
        addLog('info', 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
        
        // ì €ì¥ëœ ì„¤ì • ë¡œë“œ
        document.getElementById('slackWebhook').value = localStorage.getItem('puzzmi.slackWebhook') || '';
        document.getElementById('notifyWebhook').value = localStorage.getItem('puzzmi.notifyWebhook') || '';
        
        // ë°ì´í„° ë¡œë“œ
        await Promise.all([
          loadMates(),
          loadBookings(),
          updateDashboardStats()
        ]);
        
        addLog('info', 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
        
      } catch (error) {
        console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
        addLog('error', `ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // ì´ˆê¸°í™” ì‹¤í–‰
    await initialize();
  </script>
</body>
</html>
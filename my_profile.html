<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë‚´ ì •ë³´ - PUZZMI</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="pages.css"/>
  <link rel="stylesheet" href="pages-theme.css"/>
  <link rel="stylesheet" href="nav.css"/>
  <script type="module" src="nav.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    body.bg-cream { 
      background: var(--bg-cream); 
      background-repeat: no-repeat; 
      background-size: cover; 
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    /* ë°°ê²½ ì¥ì‹ ìš”ì†Œ */
    .decorative-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    
    .decorative-element {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.25;
      animation: float 10s ease-in-out infinite;
    }
    
    .decorative-element:nth-child(1) {
      width: 250px;
      height: 250px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      top: 15%;
      left: -5%;
      animation-delay: 0s;
    }
    
    .decorative-element:nth-child(2) {
      width: 200px;
      height: 200px;
      background: linear-gradient(45deg, #f093fb, #f5576c);
      top: 50%;
      right: -8%;
      animation-delay: 3s;
    }
    
    .decorative-element:nth-child(3) {
      width: 180px;
      height: 180px;
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      bottom: 20%;
      left: 10%;
      animation-delay: 6s;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-25px) rotate(120deg); }
      66% { transform: translateY(15px) rotate(240deg); }
    }
    
    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .profile-wrap { 
      max-width: 1000px; 
      margin: 40px auto; 
      padding: 0 20px;
      position: relative;
      z-index: 1;
    }
    
    /* í˜ì´ì§€ í—¤ë” */
    .page-header {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 28px;
      padding: 40px;
      margin-bottom: 32px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.04);
      position: relative;
      overflow: hidden;
      text-align: center;
    }
    
    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
      animation: shimmer 3s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    .page-header h2 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 70%, #f5576c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 16px 0;
      letter-spacing: -0.02em;
      position: relative;
    }
    
    .page-header h2::after {
      content: '';
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #f093fb 100%);
      border-radius: 2px;
    }
    
    .page-subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
      line-height: 1.6;
      margin: 0;
      font-weight: 500;
    }
    
    /* ì„¹ì…˜ ì¹´ë“œ */
    .section-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 24px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.06), 0 6px 16px rgba(0,0,0,0.04);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .section-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 33%, #f093fb 66%, #f5576c 100%);
      opacity: 0.8;
    }
    
    .section-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 24px 60px rgba(0,0,0,0.1), 0 8px 24px rgba(0,0,0,0.06);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .section-card:hover::before {
      opacity: 1;
      height: 4px;
    }
    
    /* ì„¹ì…˜ ì œëª© */
    .section-title {
      font-size: 1.8rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 24px 0;
      letter-spacing: -0.01em;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .section-title::before {
      content: '';
      width: 5px;
      height: 32px;
      background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
      border-radius: 3px;
      flex-shrink: 0;
    }
    
    /* í¼ ê·¸ë¦¬ë“œ */
    .form-grid {
      display: grid;
      gap: 24px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .form-row.single {
      grid-template-columns: 1fr;
    }
    
    .form-field {
      position: relative;
    }
    
    .form-label {
      display: block;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 0.95rem;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.5);
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.95) 100%);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), inset 0 2px 12px rgba(0,0,0,0.06);
      transform: translateY(-2px);
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.6;
    }
    
    .form-input::placeholder, .form-textarea::placeholder {
      color: rgba(102, 126, 234, 0.5);
      font-style: italic;
    }
    
    /* ì²´í¬ë°•ìŠ¤ ê·¸ë£¹ */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(240, 147, 251, 0.03) 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      backdrop-filter: blur(8px);
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 12px 16px;
      background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.6) 100%);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(6px);
    }
    
    .checkbox-item:hover {
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.9) 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 6px;
      background: white;
      cursor: pointer;
      position: relative;
      appearance: none;
      transition: all 0.3s ease;
    }
    
    .checkbox-item input[type="checkbox"]:checked {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .checkbox-item input[type="checkbox"]:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: 800;
      font-size: 12px;
    }
    
    .checkbox-label {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }
    
    /* ë²„íŠ¼ */
    .btn {
      padding: 14px 28px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 28px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
      color: var(--text-primary);
      border: 2px solid rgba(102, 126, 234, 0.2);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.9) 100%);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
      border-color: rgba(102, 126, 234, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(240, 147, 251, 0.3);
    }
    
    .btn-danger:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 28px rgba(240, 147, 251, 0.4);
    }
    
    /* LINE ì—°ë™ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    .btn-line {
      background: linear-gradient(135deg, #00C300 0%, #00B900 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(0, 195, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-line:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 28px rgba(0, 195, 0, 0.4);
    }
    
    .btn-line:disabled {
      opacity: 0.6;
      transform: none;
      cursor: not-allowed;
    }
    
    .line-connection-section {
      background: linear-gradient(135deg, rgba(0, 195, 0, 0.05) 0%, rgba(0, 185, 0, 0.03) 100%);
      border: 2px solid rgba(0, 195, 0, 0.2);
      border-radius: 16px;
      padding: 24px;
      backdrop-filter: blur(8px);
    }
    
    .line-status-connected {
      background: linear-gradient(135deg, #d1f2eb 0%, #a3e4d7 100%);
      color: #0e6b47;
      border-color: rgba(25, 135, 84, 0.3);
    }
    
    .line-status-disconnected {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      color: #856404;
      border-color: rgba(255, 193, 7, 0.3);
    }
    
    /* ì•¡ì…˜ ê·¸ë£¹ */
    .action-group {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-top: 24px;
      flex-wrap: wrap;
    }
    
    /* ë©”ì‹œì§€ */
    .success {
      background: linear-gradient(135deg, #d1f2eb 0%, #a3e4d7 100%);
      color: #0e6b47;
      padding: 16px 20px;
      border-radius: 12px;
      border: 2px solid rgba(25, 135, 84, 0.3);
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(25, 135, 84, 0.2);
      margin-top: 16px;
    }
    
    .error {
      background: linear-gradient(135deg, #fadbd8 0%, #f1948a 100%);
      color: #922b21;
      padding: 16px 20px;
      border-radius: 12px;
      border: 2px solid rgba(220, 53, 69, 0.3);
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
      margin-top: 16px;
    }
    
    .help-text {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.03) 100%);
      border: 1px solid rgba(102, 126, 234, 0.2);
      padding: 12px 16px;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.5;
      margin-top: 8px;
    }
    
    /* í”„ë¡œí•„ ì™„ì„±ë„ */
    .completion-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(240, 147, 251, 0.05) 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 32px;
      text-align: center;
    }
    
    .completion-title {
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 16px;
    }
    
    .progress-bar {
      width: 100%;
      height: 12px;
      background: rgba(255,255,255,0.6);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 12px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      border-radius: 6px;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: progress-shine 2s ease-in-out infinite;
    }
    
    @keyframes progress-shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    .progress-text {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* ì•„ë°”íƒ€ ì—…ë¡œë“œ */
    .avatar-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .avatar-container {
      position: relative;
      width: 120px;
      height: 120px;
    }
    
    .avatar-image {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid rgba(255,255,255,0.8);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
    }
    
    .avatar-image:hover {
      transform: scale(1.05);
      box-shadow: 0 12px 32px rgba(0,0,0,0.2);
    }
    
    .avatar-upload-btn {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: 3px solid white;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .avatar-upload-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
    }
    
    .avatar-upload-input {
      display: none;
    }
    
    /* ê³„ì • ìƒíƒœ */
    .account-status {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(240, 147, 251, 0.05) 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      margin-bottom: 24px;
    }
    
    .status-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 700;
    }
    
    .status-active {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }
    
    .status-pending {
      background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
      color: white;
    }
    
    .status-text {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      .profile-wrap {
        margin: 20px auto;
        padding: 0 16px;
      }
      
      .page-header {
        padding: 24px;
        border-radius: 20px;
      }
      
      .page-header h2 {
        font-size: 2rem;
      }
      
      .section-card {
        padding: 24px;
        border-radius: 20px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .action-group {
        flex-direction: column;
        align-items: stretch;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
    }
    
    /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-cream">
  <!-- ë°°ê²½ ì¥ì‹ ìš”ì†Œ -->
  <div class="decorative-bg">
    <div class="decorative-element"></div>
    <div class="decorative-element"></div>
    <div class="decorative-element"></div>
  </div>

  <div id="app-nav"></div>
  
  <main class="profile-wrap">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <section class="page-header">
      <h2>ë‚´ ì •ë³´</h2>
      <p class="page-subtitle">í”„ë¡œí•„ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê³  ê³„ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
    </section>

    <!-- í”„ë¡œí•„ ì™„ì„±ë„ -->
    <section class="completion-card">
      <div class="completion-title">í”„ë¡œí•„ ì™„ì„±ë„</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">0% ì™„ì„±</div>
    </section>

    <!-- ê³„ì • ìƒíƒœ -->
    <section class="account-status" id="accountStatus">
      <div class="status-icon status-active">âœ“</div>
      <div class="status-text">ê³„ì • í™œì„±í™”ë¨</div>
    </section>

    <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
    <section class="section-card">
      <h3 class="section-title">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</h3>
      
      <form id="basicInfoForm" class="form-grid">
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="fullName">ì´ë¦„</label>
            <input class="form-input" type="text" id="fullName" placeholder="ê¹€ì§€ì€"/>
          </div>
          <div class="form-field">
            <label class="form-label" for="birthDate">ìƒë…„ì›”ì¼</label>
            <input class="form-input" type="date" id="birthDate"/>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="gender">ì„±ë³„</label>
            <select class="form-select" id="gender">
              <option value="">ì„ íƒ ì•ˆí•¨</option>
              <option value="ì—¬ì„±">ì—¬ì„±</option>
              <option value="ë‚¨ì„±">ë‚¨ì„±</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€/ë¹„ê³µê°œ</option>
            </select>
          </div>
          <div class="form-field">
            <label class="form-label" for="phoneNumber">ì „í™”ë²ˆí˜¸</label>
            <input class="form-input" type="tel" id="phoneNumber" placeholder="010-1234-5678"/>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-primary" type="submit">ğŸ’¾ ê¸°ë³¸ì •ë³´ ì €ì¥</button>
          <div id="basicInfoResult"></div>
        </div>
      </form>
    </section>

    <!-- ìƒì„¸ ì •ë³´ ì„¹ì…˜ -->
    <section class="section-card">
      <h3 class="section-title">ğŸŒ ìƒì„¸ ì •ë³´</h3>
      <form id="detailInfoForm" class="form-grid">
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="nationality">êµ­ì </label>
            <select class="form-select" id="nationality">
              <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
              <option value="í•œêµ­">ğŸ‡°ğŸ‡· í•œêµ­</option>
              <option value="ì¼ë³¸">ğŸ‡¯ğŸ‡µ ì¼ë³¸</option>
              <option value="ì¤‘êµ­">ğŸ‡¨ğŸ‡³ ì¤‘êµ­</option>
              <option value="ë¯¸êµ­">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</option>
              <option value="ì˜êµ­">ğŸ‡¬ğŸ‡§ ì˜êµ­</option>
              <option value="í”„ë‘ìŠ¤">ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤</option>
              <option value="ë…ì¼">ğŸ‡©ğŸ‡ª ë…ì¼</option>
              <option value="ê¸°íƒ€">ğŸŒ ê¸°íƒ€</option>
            </select>
          </div>
          <div class="form-field">
            <label class="form-label" for="residence">í˜„ì¬ ê±°ì£¼ì§€</label>
            <input class="form-input" type="text" id="residence" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬"/>
          </div>
        </div>
        
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label" for="occupation">ì§ì—…</label>
            <input class="form-input" type="text" id="occupation" placeholder="ëŒ€í•™ìƒ, íšŒì‚¬ì›, í”„ë¦¬ëœì„œ ë“±"/>
          </div>
        </div>
        
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label">ì‚¬ìš© ê°€ëŠ¥í•œ ì–¸ì–´</label>
            <div class="checkbox-group" id="languageGroup">
              <label class="checkbox-item">
                <input type="checkbox" value="í•œêµ­ì–´"/>
                <span class="checkbox-label">ğŸ‡°ğŸ‡· í•œêµ­ì–´</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="æ—¥æœ¬èª"/>
                <span class="checkbox-label">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="English"/>
                <span class="checkbox-label">ğŸ‡ºğŸ‡¸ English</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="ä¸­æ–‡"/>
                <span class="checkbox-label">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</span>
              </label>
            </div>
            <div class="help-text">ë©”ì´íŠ¸ì™€ ì†Œí†µ ê°€ëŠ¥í•œ ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
          </div>
        </div>
        
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label">ê´€ì‹¬ì‚¬</label>
            <div class="checkbox-group" id="interestsGroup">
              <label class="checkbox-item">
                <input type="checkbox" value="ë§›ì§‘ íƒë°©"/>
                <span class="checkbox-label">ğŸ½ï¸ ë§›ì§‘ íƒë°©</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="ì¹´í˜ íˆ¬ì–´"/>
                <span class="checkbox-label">â˜• ì¹´í˜ íˆ¬ì–´</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="ì‡¼í•‘"/>
                <span class="checkbox-label">ğŸ›ï¸ ì‡¼í•‘</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="ë¬¸í™” ì²´í—˜"/>
                <span class="checkbox-label">ğŸ­ ë¬¸í™” ì²´í—˜</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="ì•¼ê²½ íˆ¬ì–´"/>
                <span class="checkbox-label">ğŸŒƒ ì•¼ê²½ íˆ¬ì–´</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="K-POP"/>
                <span class="checkbox-label">ğŸµ K-POP</span>
              </label>
            </div>
            <div class="help-text">ê´€ì‹¬ ìˆëŠ” í™œë™ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-primary" type="submit">ğŸš€ ìƒì„¸ì •ë³´ ì €ì¥</button>
          <div id="detailInfoResult"></div>
        </div>
      </form>
    </section>

    <!-- ê³„ì • ê´€ë¦¬ ì„¹ì…˜ -->
    <section class="section-card">
      <h3 class="section-title">ğŸ” ê³„ì • ê´€ë¦¬</h3>
      
      <!-- LINE ì—°ë™ ê´€ë¦¬ -->
      <div class="line-connection-section" style="margin-bottom: 32px;">
        <h4 style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <i class="fab fa-line" style="color: #00C300;"></i>
          LINE ê³„ì • ì—°ë™
        </h4>
        
        <div id="lineConnectionStatus" class="help-text" style="margin-bottom: 16px;">
          ì—°ë™ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...
        </div>
        
        <div class="action-group" id="lineActions">
          <!-- ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>
      
      <!-- ì´ë©”ì¼ ë³€ê²½ -->
      <form id="emailForm" class="form-grid">
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label" for="currentEmail">í˜„ì¬ ì´ë©”ì¼</label>
            <input class="form-input" type="email" id="currentEmail" readonly style="background: rgba(0,0,0,0.05); cursor: not-allowed;"/>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-secondary" type="button" onclick="alert('ì´ë©”ì¼ ë³€ê²½ì€ ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.')">
            ğŸ“§ ì´ë©”ì¼ ë³€ê²½ ë¬¸ì˜
          </button>
        </div>
      </form>
      
      <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
      <form id="passwordForm" class="form-grid" style="margin-top: 32px;">
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
            <input class="form-input" type="password" id="newPassword" minlength="8" placeholder="8ì ì´ìƒ ì…ë ¥"/>
          </div>
          <div class="form-field">
            <label class="form-label" for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input class="form-input" type="password" id="confirmPassword" minlength="8" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"/>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-primary" type="submit">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
          <div id="passwordResult"></div>
        </div>
      </form>
    </section>

    <!-- ê³„ì • ì‚­ì œ ì„¹ì…˜ -->
    <section class="section-card">
      <h3 class="section-title">âš ï¸ ìœ„í—˜ êµ¬ì—­</h3>
      <div class="help-text" style="margin-bottom: 20px;">
        ê³„ì •ì„ ì‚­ì œí•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      </div>
      
      <div class="action-group">
        <button class="btn btn-danger" type="button" onclick="confirmAccountDeletion()">
          ğŸ—‘ï¸ ê³„ì • ì‚­ì œ
        </button>
      </div>
    </section>
  </main>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    import { LINE_CONFIG } from './line_config.js';
    
    const supabase = createClient(
      "https://eevvgbbokenpjnvtmztk.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVldnZnYmJva2VucGpudnRtenRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NjI2OTgsImV4cCI6MjA3MzEzODY5OH0.aLoqYYeDW_0ZEwkr8c8IPFvXnEwQPZah1mQzwiyG2Y4"
    );

    // ë¡œê·¸ì¸ ì²´í¬
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      const redir = encodeURIComponent('my_profile.html');
      location.replace(`auth_combo.html?redirect=${redir}`);
      throw new Error('login required');
    }

    // DOM ìš”ì†Œë“¤
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const accountStatus = document.getElementById('accountStatus');

    // í¼ ìš”ì†Œë“¤
    const fullNameEl = document.getElementById('fullName');
    const birthDateEl = document.getElementById('birthDate');
    const genderEl = document.getElementById('gender');
    const phoneNumberEl = document.getElementById('phoneNumber');
    const nationalityEl = document.getElementById('nationality');
    const residenceEl = document.getElementById('residence');
    const occupationEl = document.getElementById('occupation');
    const currentEmailEl = document.getElementById('currentEmail');

    // ê²°ê³¼ ë©”ì‹œì§€ ìš”ì†Œë“¤
    const basicInfoResult = document.getElementById('basicInfoResult');
    const detailInfoResult = document.getElementById('detailInfoResult');
    const passwordResult = document.getElementById('passwordResult');

    // í”„ë¡œí•„ ì™„ì„±ë„ ê³„ì‚°
    function calculateCompletion(profile) {
      const fields = [
        profile.full_name,
        profile.birth_date,
        profile.gender,
        profile.phone_number,
        profile.nationality,
        profile.residence,
        profile.occupation,
        profile.languages && profile.languages.length > 0,
        profile.interests && profile.interests.length > 0
      ];
      
      const completed = fields.filter(Boolean).length;
      return Math.round((completed / fields.length) * 100);
    }

    // LINE ì—°ë™ ìƒíƒœ í™•ì¸ ë° UI ì—…ë°ì´íŠ¸
    async function checkLineConnection() {
      const statusEl = document.getElementById('lineConnectionStatus');
      const actionsEl = document.getElementById('lineActions');
      
      try {
        const { data: lineAccount, error } = await supabase
          .from('user_line_accounts')
          .select('*')
          .eq('user_id', user.id)
          .maybeSingle();
        
        if (error) throw error;
        
        if (lineAccount && lineAccount.is_verified) {
          // ì—°ë™ë¨
          statusEl.className = 'help-text line-status-connected';
          statusEl.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-check-circle" style="color: #28a745;"></i>
              <strong>LINE ê³„ì •ì´ ì—°ë™ë˜ì–´ ìˆìŠµë‹ˆë‹¤</strong>
            </div>
            <div style="font-size: 0.9rem;">
              ì—°ë™ëœ ê³„ì •: ${lineAccount.line_display_name || 'ì‚¬ìš©ì'}<br>
              ì—°ë™ì¼: ${new Date(lineAccount.connected_at).toLocaleDateString('ko-KR')}
            </div>
          `;
          
          actionsEl.innerHTML = `
            <button class="btn btn-danger" id="disconnectLineBtn">
              <i class="fab fa-line"></i>
              LINE ì—°ë™ í•´ì œ
            </button>
          `;
          
          // ì—°ë™ í•´ì œ ì´ë²¤íŠ¸
          document.getElementById('disconnectLineBtn').addEventListener('click', disconnectLine);
          
        } else {
          // ì—°ë™ ì•ˆë¨
          statusEl.className = 'help-text line-status-disconnected';
          statusEl.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-exclamation-triangle" style="color: #ffc107;"></i>
              <strong>LINE ê³„ì •ì´ ì—°ë™ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</strong>
            </div>
            <div style="font-size: 0.9rem;">
              ì˜ˆì•½ í™•ì • ë° ê²°ì œ ì•ˆë‚´ë¥¼ ë°›ìœ¼ë ¤ë©´ LINE ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.
            </div>
          `;
          
          actionsEl.innerHTML = `
            <button class="btn btn-line" id="connectLineBtn">
              <i class="fab fa-line"></i>
              LINE ê³„ì • ì—°ë™í•˜ê¸°
            </button>
          `;
          
          // ì—°ë™ ì´ë²¤íŠ¸
          document.getElementById('connectLineBtn').addEventListener('click', connectLine);
        }
        
      } catch (error) {
        console.error('LINE ì—°ë™ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
        statusEl.className = 'help-text error';
        statusEl.textContent = 'LINE ì—°ë™ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
      }
    }

    // LINE ì—°ë™ í•¨ìˆ˜
    function connectLine() {
      const btn = document.getElementById('connectLineBtn');
      const statusEl = document.getElementById('lineConnectionStatus');
      
      btn.disabled = true;
      btn.innerHTML = '<div class="loading"></div> ì—°ë™ ì¤‘...';
      
      try {
        // LINE Login URL ìƒì„±
        const lineLoginUrl = generateLineLoginUrl();
        
        if (!lineLoginUrl) {
          throw new Error('LINE ë¡œê·¸ì¸ URL ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        // ìƒˆ ì°½ì—ì„œ LINE ë¡œê·¸ì¸ ì§„í–‰
        const popup = window.open(lineLoginUrl, 'lineLogin', 'width=500,height=600');
        
        if (!popup) {
          throw new Error('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… ì°¨ë‹¨ì„ í•´ì œí•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
        
        // íŒì—… ì™„ë£Œ ëŒ€ê¸°
        const checkAuth = setInterval(() => {
          if (popup && popup.closed) {
            clearInterval(checkAuth);
            
            // ë¹„ë™ê¸° ì‘ì—…ì„ ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
            handleLineConnectionSuccess();
          }
        }, 1000);
        
      } catch (error) {
        console.error('LINE ì—°ë™ ì˜¤ë¥˜:', error);
        showToast('âŒ LINE ì—°ë™ ì˜¤ë¥˜: ' + error.message);
        
        btn.disabled = false;
        btn.innerHTML = '<i class="fab fa-line"></i> LINE ê³„ì • ì—°ë™í•˜ê¸°';
      }
    }

    // LINE ì—°ë™ ì„±ê³µ ì²˜ë¦¬ (ë¹„ë™ê¸°)
    async function handleLineConnectionSuccess() {
      try {
        // ì‹œë®¬ë ˆì´ì…˜: LINE ì—°ë™ ì„±ê³µ
        const mockLineData = {
          user_id: user.id,
          line_user_id: 'U' + Math.random().toString(36).substr(2, 9),
          line_display_name: fullNameEl.value || 'ì‚¬ìš©ì',
          line_picture_url: 'https://picsum.photos/200/200',
          is_verified: true,
          access_token: 'mock_access_token',
          token_expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
        };
        
        // LINE ê³„ì • ì •ë³´ ì €ì¥
        const { error: lineError } = await supabase
          .from('user_line_accounts')
          .upsert(mockLineData, { onConflict: 'user_id' });
        
        if (lineError) throw lineError;
        
        // ì¸ì¦ ìƒíƒœ ì €ì¥
        await supabase
          .from('user_verifications')
          .upsert({
            user_id: user.id,
            verification_type: 'line',
            is_verified: true,
            verified_at: new Date().toISOString(),
            verification_data: {
              line_user_id: mockLineData.line_user_id,
              display_name: mockLineData.line_display_name
            }
          }, { onConflict: 'user_id,verification_type' });
        
        showToast('âœ… LINE ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì—°ë™ë˜ì—ˆìŠµë‹ˆë‹¤!');
        await checkLineConnection(); // ìƒíƒœ ìƒˆë¡œê³ ì¹¨
      } catch (error) {
        console.error('LINE ì—°ë™ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        showToast('âŒ LINE ì—°ë™ ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message);
      }
    }

    // LINE ì—°ë™ í•´ì œ í•¨ìˆ˜
    async function disconnectLine() {
      if (!confirm('ì •ë§ë¡œ LINE ì—°ë™ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì—°ë™ì„ í•´ì œí•˜ë©´ ì˜ˆì•½ ê´€ë ¨ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
        return;
      }
      
      const btn = document.getElementById('disconnectLineBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="loading"></div> í•´ì œ ì¤‘...';
      
      try {
        // LINE ê³„ì • ì •ë³´ ì‚­ì œ
        const { error: lineError } = await supabase
          .from('user_line_accounts')
          .delete()
          .eq('user_id', user.id);
        
        if (lineError) throw lineError;
        
        // ì¸ì¦ ìƒíƒœ ì‚­ì œ
        await supabase
          .from('user_verifications')
          .delete()
          .eq('user_id', user.id)
          .eq('verification_type', 'line');
        
        showToast('ğŸ’” LINE ì—°ë™ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        await checkLineConnection(); // ìƒíƒœ ìƒˆë¡œê³ ì¹¨
        
      } catch (error) {
        console.error('LINE ì—°ë™ í•´ì œ ì‹¤íŒ¨:', error);
        showToast('âŒ LINE ì—°ë™ í•´ì œ ì‹¤íŒ¨: ' + error.message);
        
        btn.disabled = false;
        btn.innerHTML = '<i class="fab fa-line"></i> LINE ì—°ë™ í•´ì œ';
      }
    }

    // LINE Login URL ìƒì„±
    function generateLineLoginUrl() {
      try {
        return LINE_CONFIG.generateLoginUrl(user.id);
      } catch (error) {
        console.error('LINE URL ìƒì„± ì‹¤íŒ¨:', error);
        return null;
      }
    }
    // í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ
    async function loadProfile() {
      try {
        const { data: profile, error } = await supabase
          .from('profiles')
          .select('*')
          .eq('id', user.id)
          .single();

        if (error) throw error;

        // ê¸°ë³¸ ì •ë³´ ì±„ìš°ê¸°
        fullNameEl.value = profile.full_name || '';
        birthDateEl.value = profile.birth_date || '';
        genderEl.value = profile.gender || '';
        phoneNumberEl.value = profile.phone_number || '';
        nationalityEl.value = profile.nationality || '';
        residenceEl.value = profile.residence || '';
        occupationEl.value = profile.occupation || '';
        currentEmailEl.value = user.email || '';

        // ì–¸ì–´ ì²´í¬ë°•ìŠ¤
        const languages = Array.isArray(profile.languages) ? profile.languages : [];
        document.querySelectorAll('#languageGroup input[type="checkbox"]').forEach(cb => {
          cb.checked = languages.includes(cb.value);
        });

        // ê´€ì‹¬ì‚¬ ì²´í¬ë°•ìŠ¤
        const interests = Array.isArray(profile.interests) ? profile.interests : [];
        document.querySelectorAll('#interestsGroup input[type="checkbox"]').forEach(cb => {
          cb.checked = interests.includes(cb.value);
        });

        // í”„ë¡œí•„ ì™„ì„±ë„ ì—…ë°ì´íŠ¸
        const completion = calculateCompletion(profile);
        progressFill.style.width = completion + '%';
        progressText.textContent = completion + '% ì™„ì„±';

        // ê³„ì • ìƒíƒœ ì—…ë°ì´íŠ¸
        const statusIcon = accountStatus.querySelector('.status-icon');
        const statusText = accountStatus.querySelector('.status-text');
        
        if (profile.account_status === 'active') {
          statusIcon.className = 'status-icon status-active';
          statusIcon.textContent = 'âœ“';
          statusText.textContent = 'ê³„ì • í™œì„±í™”ë¨';
        } else {
          statusIcon.className = 'status-icon status-pending';
          statusIcon.textContent = 'â³';
          statusText.textContent = 'ê³„ì • ê²€í†  ì¤‘';
        }

      } catch (error) {
        console.error('í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨:', error);
        basicInfoResult.innerHTML = `<div class="error">âŒ í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
      }
    }

    // ê¸°ë³¸ ì •ë³´ ì €ì¥
    document.getElementById('basicInfoForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading"></div> ì €ì¥ ì¤‘...';
      
      try {
        // ìƒë…„ì›”ì¼ì—ì„œ ë‚˜ì´ ê³„ì‚°
        let age = null;
        if (birthDateEl.value) {
          const today = new Date();
          const birthDate = new Date(birthDateEl.value);
          age = today.getFullYear() - birthDate.getFullYear();
          const monthDiff = today.getMonth() - birthDate.getMonth();
          if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
            age--;
          }
        }

        const updateData = {
          full_name: fullNameEl.value.trim() || null,
          birth_date: birthDateEl.value || null,
          age: age,
          gender: genderEl.value || null,
          phone_number: phoneNumberEl.value.trim() || null,
          updated_at: new Date().toISOString()
        };

        const { error } = await supabase
          .from('profiles')
          .update(updateData)
          .eq('id', user.id);

        if (error) throw error;

        basicInfoResult.innerHTML = '<div class="success">âœ… ê¸°ë³¸ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
        await loadProfile(); // ì™„ì„±ë„ ì—…ë°ì´íŠ¸

      } catch (error) {
        console.error('ê¸°ë³¸ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', error);
        basicInfoResult.innerHTML = `<div class="error">âŒ ì €ì¥ ì‹¤íŒ¨: ${error.message}</div>`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'ğŸ’¾ ê¸°ë³¸ì •ë³´ ì €ì¥';
      }
    });

    // ìƒì„¸ ì •ë³´ ì €ì¥
    document.getElementById('detailInfoForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading"></div> ì €ì¥ ì¤‘...';
      
      try {
        // ì„ íƒëœ ì–¸ì–´ë“¤ ìˆ˜ì§‘
        const selectedLanguages = Array.from(document.querySelectorAll('#languageGroup input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        // ì„ íƒëœ ê´€ì‹¬ì‚¬ë“¤ ìˆ˜ì§‘
        const selectedInterests = Array.from(document.querySelectorAll('#interestsGroup input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        const updateData = {
          nationality: nationalityEl.value || null,
          residence: residenceEl.value.trim() || null,
          occupation: occupationEl.value.trim() || null,
          languages: selectedLanguages.length > 0 ? selectedLanguages : null,
          interests: selectedInterests.length > 0 ? selectedInterests : null,
          updated_at: new Date().toISOString()
        };

        const { error } = await supabase
          .from('profiles')
          .update(updateData)
          .eq('id', user.id);

        if (error) throw error;

        detailInfoResult.innerHTML = '<div class="success">âœ… ìƒì„¸ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
        await loadProfile(); // ì™„ì„±ë„ ì—…ë°ì´íŠ¸

      } catch (error) {
        console.error('ìƒì„¸ì •ë³´ ì €ì¥ ì‹¤íŒ¨:', error);
        detailInfoResult.innerHTML = `<div class="error">âŒ ì €ì¥ ì‹¤íŒ¨: ${error.message}</div>`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'ğŸš€ ìƒì„¸ì •ë³´ ì €ì¥';
      }
    });

    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
    document.getElementById('passwordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const submitBtn = e.target.querySelector('button[type="submit"]');
      
      if (newPassword !== confirmPassword) {
        passwordResult.innerHTML = '<div class="error">âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>';
        return;
      }
      
      if (newPassword.length < 8) {
        passwordResult.innerHTML = '<div class="error">âŒ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.</div>';
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading"></div> ë³€ê²½ ì¤‘...';
      
      try {
        const { error } = await supabase.auth.updateUser({
          password: newPassword
        });

        if (error) throw error;

        passwordResult.innerHTML = '<div class="success">âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';

      } catch (error) {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨:', error);
        passwordResult.innerHTML = `<div class="error">âŒ ë³€ê²½ ì‹¤íŒ¨: ${error.message}</div>`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½';
      }
    });

    // ê³„ì • ì‚­ì œ í™•ì¸
    window.confirmAccountDeletion = function() {
      const confirmText = 'ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.\n\nê³„ì†í•˜ë ¤ë©´ "ì‚­ì œ"ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
      const userInput = prompt(confirmText);
      
      if (userInput === 'ì‚­ì œ') {
        deleteAccount();
      } else if (userInput !== null) {
        alert('ì…ë ¥ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê³„ì • ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    };

    // ê³„ì • ì‚­ì œ ì‹¤í–‰
    async function deleteAccount() {
      try {
        // ê´€ë ¨ ë°ì´í„° ì‚­ì œëŠ” CASCADEë¡œ ìë™ ì²˜ë¦¬ë¨
        const { error } = await supabase.auth.admin.deleteUser(user.id);
        
        if (error) throw error;
        
        alert('ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        location.href = 'index.html';
        
      } catch (error) {
        console.error('ê³„ì • ì‚­ì œ ì‹¤íŒ¨:', error);
        alert('ê³„ì • ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
      }
    }

    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
    function showToast(message) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white; padding: 12px 24px; border-radius: 12px;
        z-index: 9999; font-weight: 600; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        animation: slideDown 0.3s ease;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // ì´ˆê¸° ë¡œë“œ
    await loadProfile();
    await checkLineConnection();
  </script>
</body>
</html>
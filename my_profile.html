<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>내 정보 - PUZZMI</title>
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="pages.css"/>
  <link rel="stylesheet" href="pages-theme.css"/>
  <link rel="stylesheet" href="nav.css"/>
  <script type="module" src="nav.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    body.bg-cream { 
      background: var(--bg-cream); 
      background-repeat: no-repeat; 
      background-size: cover; 
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    /* 배경 장식 요소 */
    .decorative-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }
    
    .decorative-element {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.25;
      animation: float 10s ease-in-out infinite;
    }
    
    .decorative-element:nth-child(1) {
      width: 250px;
      height: 250px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      top: 15%;
      left: -5%;
      animation-delay: 0s;
    }
    
    .decorative-element:nth-child(2) {
      width: 200px;
      height: 200px;
      background: linear-gradient(45deg, #f093fb, #f5576c);
      top: 50%;
      right: -8%;
      animation-delay: 3s;
    }
    
    .decorative-element:nth-child(3) {
      width: 180px;
      height: 180px;
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      bottom: 20%;
      left: 10%;
      animation-delay: 6s;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      33% { transform: translateY(-25px) rotate(120deg); }
      66% { transform: translateY(15px) rotate(240deg); }
    }
    
    /* 메인 컨테이너 */
    .profile-wrap { 
      max-width: 1000px; 
      margin: 40px auto; 
      padding: 0 20px;
      position: relative;
      z-index: 1;
    }
    
    /* 페이지 헤더 */
    .page-header {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 28px;
      padding: 40px;
      margin-bottom: 32px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.08), 0 8px 24px rgba(0,0,0,0.04);
      position: relative;
      overflow: hidden;
      text-align: center;
    }
    
    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
      animation: shimmer 3s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    .page-header h2 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 70%, #f5576c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 16px 0;
      letter-spacing: -0.02em;
      position: relative;
    }
    
    .page-header h2::after {
      content: '';
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #f093fb 100%);
      border-radius: 2px;
    }
    
    .page-subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
      line-height: 1.6;
      margin: 0;
      font-weight: 500;
    }
    
    /* 섹션 카드 */
    .section-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.92) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 24px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.06), 0 6px 16px rgba(0,0,0,0.04);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .section-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 33%, #f093fb 66%, #f5576c 100%);
      opacity: 0.8;
    }
    
    .section-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 24px 60px rgba(0,0,0,0.1), 0 8px 24px rgba(0,0,0,0.06);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .section-card:hover::before {
      opacity: 1;
      height: 4px;
    }
    
    /* 섹션 제목 */
    .section-title {
      font-size: 1.8rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 24px 0;
      letter-spacing: -0.01em;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .section-title::before {
      content: '';
      width: 5px;
      height: 32px;
      background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
      border-radius: 3px;
      flex-shrink: 0;
    }
    
    /* 폼 그리드 */
    .form-grid {
      display: grid;
      gap: 24px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .form-row.single {
      grid-template-columns: 1fr;
    }
    
    .form-field {
      position: relative;
    }
    
    .form-label {
      display: block;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 0.95rem;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.5);
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.95) 100%);
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1), inset 0 2px 12px rgba(0,0,0,0.06);
      transform: translateY(-2px);
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.6;
    }
    
    .form-input::placeholder, .form-textarea::placeholder {
      color: rgba(102, 126, 234, 0.5);
      font-style: italic;
    }
    
    /* 체크박스 그룹 */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(240, 147, 251, 0.03) 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      backdrop-filter: blur(8px);
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 12px 16px;
      background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0.6) 100%);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(6px);
    }
    
    .checkbox-item:hover {
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.9) 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(102, 126, 234, 0.3);
      border-radius: 6px;
      background: white;
      cursor: pointer;
      position: relative;
      appearance: none;
      transition: all 0.3s ease;
    }
    
    .checkbox-item input[type="checkbox"]:checked {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .checkbox-item input[type="checkbox"]:checked::after {
      content: '✓';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-weight: 800;
      font-size: 12px;
    }
    
    .checkbox-label {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }
    
    /* 버튼 */
    .btn {
      padding: 14px 28px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 28px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
      color: var(--text-primary);
      border: 2px solid rgba(102, 126, 234, 0.2);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0.9) 100%);
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
      border-color: rgba(102, 126, 234, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(240, 147, 251, 0.3);
    }
    
    .btn-danger:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 28px rgba(240, 147, 251, 0.4);
    }
    
    /* LINE 연동 관련 스타일 */
    .btn-line {
      background: linear-gradient(135deg, #00C300 0%, #00B900 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(0, 195, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-line:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 12px 28px rgba(0, 195, 0, 0.4);
    }
    
    .btn-line:disabled {
      opacity: 0.6;
      transform: none;
      cursor: not-allowed;
    }
    
    .line-connection-section {
      background: linear-gradient(135deg, rgba(0, 195, 0, 0.05) 0%, rgba(0, 185, 0, 0.03) 100%);
      border: 2px solid rgba(0, 195, 0, 0.2);
      border-radius: 16px;
      padding: 24px;
      backdrop-filter: blur(8px);
    }
    
    .line-status-connected {
      background: linear-gradient(135deg, #d1f2eb 0%, #a3e4d7 100%);
      color: #0e6b47;
      border-color: rgba(25, 135, 84, 0.3);
    }
    
    .line-status-disconnected {
      background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
      color: #856404;
      border-color: rgba(255, 193, 7, 0.3);
    }
    
    /* 액션 그룹 */
    .action-group {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-top: 24px;
      flex-wrap: wrap;
    }
    
    /* 메시지 */
    .success {
      background: linear-gradient(135deg, #d1f2eb 0%, #a3e4d7 100%);
      color: #0e6b47;
      padding: 16px 20px;
      border-radius: 12px;
      border: 2px solid rgba(25, 135, 84, 0.3);
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(25, 135, 84, 0.2);
      margin-top: 16px;
    }
    
    .error {
      background: linear-gradient(135deg, #fadbd8 0%, #f1948a 100%);
      color: #922b21;
      padding: 16px 20px;
      border-radius: 12px;
      border: 2px solid rgba(220, 53, 69, 0.3);
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
      margin-top: 16px;
    }
    
    .help-text {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.03) 100%);
      border: 1px solid rgba(102, 126, 234, 0.2);
      padding: 12px 16px;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.5;
      margin-top: 8px;
    }
    
    /* 프로필 완성도 */
    .completion-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(240, 147, 251, 0.05) 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 32px;
      text-align: center;
    }
    
    .completion-title {
      font-size: 1.3rem;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 16px;
    }
    
    .progress-bar {
      width: 100%;
      height: 12px;
      background: rgba(255,255,255,0.6);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 12px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      border-radius: 6px;
      transition: width 0.5s ease;
      position: relative;
      overflow: hidden;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      animation: progress-shine 2s ease-in-out infinite;
    }
    
    @keyframes progress-shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }
    
    .progress-text {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* 아바타 업로드 */
    .avatar-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .avatar-container {
      position: relative;
      width: 120px;
      height: 120px;
    }
    
    .avatar-image {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid rgba(255,255,255,0.8);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
    }
    
    .avatar-image:hover {
      transform: scale(1.05);
      box-shadow: 0 12px 32px rgba(0,0,0,0.2);
    }
    
    .avatar-upload-btn {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: 3px solid white;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .avatar-upload-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5);
    }
    
    .avatar-upload-input {
      display: none;
    }
    
    /* 계정 상태 */
    .account-status {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(240, 147, 251, 0.05) 100%);
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      margin-bottom: 24px;
    }
    
    .status-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      font-weight: 700;
    }
    
    .status-active {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }
    
    .status-pending {
      background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
      color: white;
    }
    
    .status-text {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* 반응형 디자인 */
    @media (max-width: 768px) {
      .profile-wrap {
        margin: 20px auto;
        padding: 0 16px;
      }
      
      .page-header {
        padding: 24px;
        border-radius: 20px;
      }
      
      .page-header h2 {
        font-size: 2rem;
      }
      
      .section-card {
        padding: 24px;
        border-radius: 20px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .action-group {
        flex-direction: column;
        align-items: stretch;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
    }
    
    /* 로딩 애니메이션 */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-cream">
  <!-- 배경 장식 요소 -->
  <div class="decorative-bg">
    <div class="decorative-element"></div>
    <div class="decorative-element"></div>
    <div class="decorative-element"></div>
  </div>

  <div id="app-nav"></div>
  
  <main class="profile-wrap">
    <!-- 페이지 헤더 -->
    <section class="page-header">
      <h2>내 정보</h2>
      <p class="page-subtitle">프로필 정보를 수정하고 계정을 관리하세요</p>
    </section>

    <!-- 프로필 완성도 -->
    <section class="completion-card">
      <div class="completion-title">프로필 완성도</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">0% 완성</div>
    </section>

    <!-- 계정 상태 -->
    <section class="account-status" id="accountStatus">
      <div class="status-icon status-active">✓</div>
      <div class="status-text">계정 활성화됨</div>
    </section>

    <!-- 기본 정보 섹션 -->
    <section class="section-card">
      <h3 class="section-title">👤 기본 정보</h3>
      
      <form id="basicInfoForm" class="form-grid">
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="fullName">이름</label>
            <input class="form-input" type="text" id="fullName" placeholder="김지은"/>
          </div>
          <div class="form-field">
            <label class="form-label" for="birthDate">생년월일</label>
            <input class="form-input" type="date" id="birthDate"/>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="gender">성별</label>
            <select class="form-select" id="gender">
              <option value="">선택 안함</option>
              <option value="여성">여성</option>
              <option value="남성">남성</option>
              <option value="기타">기타/비공개</option>
            </select>
          </div>
          <div class="form-field">
            <label class="form-label" for="phoneNumber">전화번호</label>
            <input class="form-input" type="tel" id="phoneNumber" placeholder="010-1234-5678"/>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-primary" type="submit">💾 기본정보 저장</button>
          <div id="basicInfoResult"></div>
        </div>
      </form>
    </section>

    <!-- 상세 정보 섹션 -->
    <section class="section-card">
      <h3 class="section-title">🌍 상세 정보</h3>
      <form id="detailInfoForm" class="form-grid">
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="nationality">국적</label>
            <select class="form-select" id="nationality">
              <option value="">선택해주세요</option>
              <option value="한국">🇰🇷 한국</option>
              <option value="일본">🇯🇵 일본</option>
              <option value="중국">🇨🇳 중국</option>
              <option value="미국">🇺🇸 미국</option>
              <option value="영국">🇬🇧 영국</option>
              <option value="프랑스">🇫🇷 프랑스</option>
              <option value="독일">🇩🇪 독일</option>
              <option value="기타">🌍 기타</option>
            </select>
          </div>
          <div class="form-field">
            <label class="form-label" for="residence">현재 거주지</label>
            <input class="form-input" type="text" id="residence" placeholder="서울특별시 강남구"/>
          </div>
        </div>
        
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label" for="occupation">직업</label>
            <input class="form-input" type="text" id="occupation" placeholder="대학생, 회사원, 프리랜서 등"/>
          </div>
        </div>
        
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label">사용 가능한 언어</label>
            <div class="checkbox-group" id="languageGroup">
              <label class="checkbox-item">
                <input type="checkbox" value="한국어"/>
                <span class="checkbox-label">🇰🇷 한국어</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="日本語"/>
                <span class="checkbox-label">🇯🇵 日本語</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="English"/>
                <span class="checkbox-label">🇺🇸 English</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="中文"/>
                <span class="checkbox-label">🇨🇳 中文</span>
              </label>
            </div>
            <div class="help-text">메이트와 소통 가능한 언어를 선택해주세요</div>
          </div>
        </div>
        
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label">관심사</label>
            <div class="checkbox-group" id="interestsGroup">
              <label class="checkbox-item">
                <input type="checkbox" value="맛집 탐방"/>
                <span class="checkbox-label">🍽️ 맛집 탐방</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="카페 투어"/>
                <span class="checkbox-label">☕ 카페 투어</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="쇼핑"/>
                <span class="checkbox-label">🛍️ 쇼핑</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="문화 체험"/>
                <span class="checkbox-label">🎭 문화 체험</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="야경 투어"/>
                <span class="checkbox-label">🌃 야경 투어</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" value="K-POP"/>
                <span class="checkbox-label">🎵 K-POP</span>
              </label>
            </div>
            <div class="help-text">관심 있는 활동을 선택해주세요</div>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-primary" type="submit">🚀 상세정보 저장</button>
          <div id="detailInfoResult"></div>
        </div>
      </form>
    </section>

    <!-- 계정 관리 섹션 -->
    <section class="section-card">
      <h3 class="section-title">🔐 계정 관리</h3>
      
      <!-- LINE 연동 관리 -->
      <div class="line-connection-section" style="margin-bottom: 32px;">
        <h4 style="font-size: 1.2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <i class="fab fa-line" style="color: #00C300;"></i>
          LINE 계정 연동
        </h4>
        
        <div id="lineConnectionStatus" class="help-text" style="margin-bottom: 16px;">
          연동 상태를 확인하는 중...
        </div>
        
        <div class="action-group" id="lineActions">
          <!-- 버튼들이 동적으로 추가됩니다 -->
        </div>
      </div>
      
      <!-- 이메일 변경 -->
      <form id="emailForm" class="form-grid">
        <div class="form-row single">
          <div class="form-field">
            <label class="form-label" for="currentEmail">현재 이메일</label>
            <input class="form-input" type="email" id="currentEmail" readonly style="background: rgba(0,0,0,0.05); cursor: not-allowed;"/>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-secondary" type="button" onclick="alert('이메일 변경은 고객센터에 문의해주세요.')">
            📧 이메일 변경 문의
          </button>
        </div>
      </form>
      
      <!-- 비밀번호 변경 -->
      <form id="passwordForm" class="form-grid" style="margin-top: 32px;">
        <div class="form-row">
          <div class="form-field">
            <label class="form-label" for="newPassword">새 비밀번호</label>
            <input class="form-input" type="password" id="newPassword" minlength="8" placeholder="8자 이상 입력"/>
          </div>
          <div class="form-field">
            <label class="form-label" for="confirmPassword">비밀번호 확인</label>
            <input class="form-input" type="password" id="confirmPassword" minlength="8" placeholder="비밀번호 재입력"/>
          </div>
        </div>
        
        <div class="action-group">
          <button class="btn btn-primary" type="submit">🔒 비밀번호 변경</button>
          <div id="passwordResult"></div>
        </div>
      </form>
    </section>

    <!-- 계정 삭제 섹션 -->
    <section class="section-card">
      <h3 class="section-title">⚠️ 위험 구역</h3>
      <div class="help-text" style="margin-bottom: 20px;">
        계정을 삭제하면 모든 데이터가 영구적으로 삭제되며 복구할 수 없습니다.
      </div>
      
      <div class="action-group">
        <button class="btn btn-danger" type="button" onclick="confirmAccountDeletion()">
          🗑️ 계정 삭제
        </button>
      </div>
    </section>
  </main>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    import { LINE_CONFIG } from './line_config.js';
    
    const supabase = createClient(
      "https://eevvgbbokenpjnvtmztk.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVldnZnYmJva2VucGpudnRtenRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NjI2OTgsImV4cCI6MjA3MzEzODY5OH0.aLoqYYeDW_0ZEwkr8c8IPFvXnEwQPZah1mQzwiyG2Y4"
    );

    // 로그인 체크
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      const redir = encodeURIComponent('my_profile.html');
      location.replace(`auth_combo.html?redirect=${redir}`);
      throw new Error('login required');
    }

    // DOM 요소들
    const progressFill = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const accountStatus = document.getElementById('accountStatus');

    // 폼 요소들
    const fullNameEl = document.getElementById('fullName');
    const birthDateEl = document.getElementById('birthDate');
    const genderEl = document.getElementById('gender');
    const phoneNumberEl = document.getElementById('phoneNumber');
    const nationalityEl = document.getElementById('nationality');
    const residenceEl = document.getElementById('residence');
    const occupationEl = document.getElementById('occupation');
    const currentEmailEl = document.getElementById('currentEmail');

    // 결과 메시지 요소들
    const basicInfoResult = document.getElementById('basicInfoResult');
    const detailInfoResult = document.getElementById('detailInfoResult');
    const passwordResult = document.getElementById('passwordResult');

    // 프로필 완성도 계산
    function calculateCompletion(profile) {
      const fields = [
        profile.full_name,
        profile.birth_date,
        profile.gender,
        profile.phone_number,
        profile.nationality,
        profile.residence,
        profile.occupation,
        profile.languages && profile.languages.length > 0,
        profile.interests && profile.interests.length > 0
      ];
      
      const completed = fields.filter(Boolean).length;
      return Math.round((completed / fields.length) * 100);
    }

    // LINE 연동 상태 확인 및 UI 업데이트
    async function checkLineConnection() {
      const statusEl = document.getElementById('lineConnectionStatus');
      const actionsEl = document.getElementById('lineActions');
      
      try {
        const { data: lineAccount, error } = await supabase
          .from('user_line_accounts')
          .select('*')
          .eq('user_id', user.id)
          .maybeSingle();
        
        if (error) throw error;
        
        if (lineAccount && lineAccount.is_verified) {
          // 연동됨
          statusEl.className = 'help-text line-status-connected';
          statusEl.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-check-circle" style="color: #28a745;"></i>
              <strong>LINE 계정이 연동되어 있습니다</strong>
            </div>
            <div style="font-size: 0.9rem;">
              연동된 계정: ${lineAccount.line_display_name || '사용자'}<br>
              연동일: ${new Date(lineAccount.connected_at).toLocaleDateString('ko-KR')}
            </div>
          `;
          
          actionsEl.innerHTML = `
            <button class="btn btn-danger" id="disconnectLineBtn">
              <i class="fab fa-line"></i>
              LINE 연동 해제
            </button>
          `;
          
          // 연동 해제 이벤트
          document.getElementById('disconnectLineBtn').addEventListener('click', disconnectLine);
          
        } else {
          // 연동 안됨
          statusEl.className = 'help-text line-status-disconnected';
          statusEl.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <i class="fas fa-exclamation-triangle" style="color: #ffc107;"></i>
              <strong>LINE 계정이 연동되지 않았습니다</strong>
            </div>
            <div style="font-size: 0.9rem;">
              예약 확정 및 결제 안내를 받으려면 LINE 연동이 필요합니다.
            </div>
          `;
          
          actionsEl.innerHTML = `
            <button class="btn btn-line" id="connectLineBtn">
              <i class="fab fa-line"></i>
              LINE 계정 연동하기
            </button>
          `;
          
          // 연동 이벤트
          document.getElementById('connectLineBtn').addEventListener('click', connectLine);
        }
        
      } catch (error) {
        console.error('LINE 연동 상태 확인 실패:', error);
        statusEl.className = 'help-text error';
        statusEl.textContent = 'LINE 연동 상태를 확인할 수 없습니다.';
      }
    }

    // LINE 연동 함수
    function connectLine() {
      const btn = document.getElementById('connectLineBtn');
      const statusEl = document.getElementById('lineConnectionStatus');
      
      btn.disabled = true;
      btn.innerHTML = '<div class="loading"></div> 연동 중...';
      
      try {
        // LINE Login URL 생성
        const lineLoginUrl = generateLineLoginUrl();
        
        if (!lineLoginUrl) {
          throw new Error('LINE 로그인 URL 생성에 실패했습니다.');
        }
        
        // 새 창에서 LINE 로그인 진행
        const popup = window.open(lineLoginUrl, 'lineLogin', 'width=500,height=600');
        
        if (!popup) {
          throw new Error('팝업이 차단되었습니다. 팝업 차단을 해제하고 다시 시도해주세요.');
        }
        
        // 팝업 완료 대기
        const checkAuth = setInterval(() => {
          if (popup && popup.closed) {
            clearInterval(checkAuth);
            
            // 비동기 작업을 별도 함수로 분리
            handleLineConnectionSuccess();
          }
        }, 1000);
        
      } catch (error) {
        console.error('LINE 연동 오류:', error);
        showToast('❌ LINE 연동 오류: ' + error.message);
        
        btn.disabled = false;
        btn.innerHTML = '<i class="fab fa-line"></i> LINE 계정 연동하기';
      }
    }

    // LINE 연동 성공 처리 (비동기)
    async function handleLineConnectionSuccess() {
      try {
        // 시뮬레이션: LINE 연동 성공
        const mockLineData = {
          user_id: user.id,
          line_user_id: 'U' + Math.random().toString(36).substr(2, 9),
          line_display_name: fullNameEl.value || '사용자',
          line_picture_url: 'https://picsum.photos/200/200',
          is_verified: true,
          access_token: 'mock_access_token',
          token_expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString()
        };
        
        // LINE 계정 정보 저장
        const { error: lineError } = await supabase
          .from('user_line_accounts')
          .upsert(mockLineData, { onConflict: 'user_id' });
        
        if (lineError) throw lineError;
        
        // 인증 상태 저장
        await supabase
          .from('user_verifications')
          .upsert({
            user_id: user.id,
            verification_type: 'line',
            is_verified: true,
            verified_at: new Date().toISOString(),
            verification_data: {
              line_user_id: mockLineData.line_user_id,
              display_name: mockLineData.line_display_name
            }
          }, { onConflict: 'user_id,verification_type' });
        
        showToast('✅ LINE 계정이 성공적으로 연동되었습니다!');
        await checkLineConnection(); // 상태 새로고침
      } catch (error) {
        console.error('LINE 연동 처리 실패:', error);
        showToast('❌ LINE 연동 처리 실패: ' + error.message);
      }
    }

    // LINE 연동 해제 함수
    async function disconnectLine() {
      if (!confirm('정말로 LINE 연동을 해제하시겠습니까?\n\n연동을 해제하면 예약 관련 알림을 받을 수 없습니다.')) {
        return;
      }
      
      const btn = document.getElementById('disconnectLineBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="loading"></div> 해제 중...';
      
      try {
        // LINE 계정 정보 삭제
        const { error: lineError } = await supabase
          .from('user_line_accounts')
          .delete()
          .eq('user_id', user.id);
        
        if (lineError) throw lineError;
        
        // 인증 상태 삭제
        await supabase
          .from('user_verifications')
          .delete()
          .eq('user_id', user.id)
          .eq('verification_type', 'line');
        
        showToast('💔 LINE 연동이 해제되었습니다');
        await checkLineConnection(); // 상태 새로고침
        
      } catch (error) {
        console.error('LINE 연동 해제 실패:', error);
        showToast('❌ LINE 연동 해제 실패: ' + error.message);
        
        btn.disabled = false;
        btn.innerHTML = '<i class="fab fa-line"></i> LINE 연동 해제';
      }
    }

    // LINE Login URL 생성
    function generateLineLoginUrl() {
      try {
        return LINE_CONFIG.generateLoginUrl(user.id);
      } catch (error) {
        console.error('LINE URL 생성 실패:', error);
        return null;
      }
    }
    // 프로필 데이터 로드
    async function loadProfile() {
      try {
        const { data: profile, error } = await supabase
          .from('profiles')
          .select('*')
          .eq('id', user.id)
          .single();

        if (error) throw error;

        // 기본 정보 채우기
        fullNameEl.value = profile.full_name || '';
        birthDateEl.value = profile.birth_date || '';
        genderEl.value = profile.gender || '';
        phoneNumberEl.value = profile.phone_number || '';
        nationalityEl.value = profile.nationality || '';
        residenceEl.value = profile.residence || '';
        occupationEl.value = profile.occupation || '';
        currentEmailEl.value = user.email || '';

        // 언어 체크박스
        const languages = Array.isArray(profile.languages) ? profile.languages : [];
        document.querySelectorAll('#languageGroup input[type="checkbox"]').forEach(cb => {
          cb.checked = languages.includes(cb.value);
        });

        // 관심사 체크박스
        const interests = Array.isArray(profile.interests) ? profile.interests : [];
        document.querySelectorAll('#interestsGroup input[type="checkbox"]').forEach(cb => {
          cb.checked = interests.includes(cb.value);
        });

        // 프로필 완성도 업데이트
        const completion = calculateCompletion(profile);
        progressFill.style.width = completion + '%';
        progressText.textContent = completion + '% 완성';

        // 계정 상태 업데이트
        const statusIcon = accountStatus.querySelector('.status-icon');
        const statusText = accountStatus.querySelector('.status-text');
        
        if (profile.account_status === 'active') {
          statusIcon.className = 'status-icon status-active';
          statusIcon.textContent = '✓';
          statusText.textContent = '계정 활성화됨';
        } else {
          statusIcon.className = 'status-icon status-pending';
          statusIcon.textContent = '⏳';
          statusText.textContent = '계정 검토 중';
        }

      } catch (error) {
        console.error('프로필 로드 실패:', error);
        basicInfoResult.innerHTML = `<div class="error">❌ 프로필 로드 실패: ${error.message}</div>`;
      }
    }

    // 기본 정보 저장
    document.getElementById('basicInfoForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading"></div> 저장 중...';
      
      try {
        // 생년월일에서 나이 계산
        let age = null;
        if (birthDateEl.value) {
          const today = new Date();
          const birthDate = new Date(birthDateEl.value);
          age = today.getFullYear() - birthDate.getFullYear();
          const monthDiff = today.getMonth() - birthDate.getMonth();
          if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
            age--;
          }
        }

        const updateData = {
          full_name: fullNameEl.value.trim() || null,
          birth_date: birthDateEl.value || null,
          age: age,
          gender: genderEl.value || null,
          phone_number: phoneNumberEl.value.trim() || null,
          updated_at: new Date().toISOString()
        };

        const { error } = await supabase
          .from('profiles')
          .update(updateData)
          .eq('id', user.id);

        if (error) throw error;

        basicInfoResult.innerHTML = '<div class="success">✅ 기본정보가 저장되었습니다!</div>';
        await loadProfile(); // 완성도 업데이트

      } catch (error) {
        console.error('기본정보 저장 실패:', error);
        basicInfoResult.innerHTML = `<div class="error">❌ 저장 실패: ${error.message}</div>`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '💾 기본정보 저장';
      }
    });

    // 상세 정보 저장
    document.getElementById('detailInfoForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading"></div> 저장 중...';
      
      try {
        // 선택된 언어들 수집
        const selectedLanguages = Array.from(document.querySelectorAll('#languageGroup input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        // 선택된 관심사들 수집
        const selectedInterests = Array.from(document.querySelectorAll('#interestsGroup input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        const updateData = {
          nationality: nationalityEl.value || null,
          residence: residenceEl.value.trim() || null,
          occupation: occupationEl.value.trim() || null,
          languages: selectedLanguages.length > 0 ? selectedLanguages : null,
          interests: selectedInterests.length > 0 ? selectedInterests : null,
          updated_at: new Date().toISOString()
        };

        const { error } = await supabase
          .from('profiles')
          .update(updateData)
          .eq('id', user.id);

        if (error) throw error;

        detailInfoResult.innerHTML = '<div class="success">✅ 상세정보가 저장되었습니다!</div>';
        await loadProfile(); // 완성도 업데이트

      } catch (error) {
        console.error('상세정보 저장 실패:', error);
        detailInfoResult.innerHTML = `<div class="error">❌ 저장 실패: ${error.message}</div>`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '🚀 상세정보 저장';
      }
    });

    // 비밀번호 변경
    document.getElementById('passwordForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const submitBtn = e.target.querySelector('button[type="submit"]');
      
      if (newPassword !== confirmPassword) {
        passwordResult.innerHTML = '<div class="error">❌ 비밀번호가 일치하지 않습니다.</div>';
        return;
      }
      
      if (newPassword.length < 8) {
        passwordResult.innerHTML = '<div class="error">❌ 비밀번호는 8자 이상이어야 합니다.</div>';
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<div class="loading"></div> 변경 중...';
      
      try {
        const { error } = await supabase.auth.updateUser({
          password: newPassword
        });

        if (error) throw error;

        passwordResult.innerHTML = '<div class="success">✅ 비밀번호가 변경되었습니다!</div>';
        document.getElementById('newPassword').value = '';
        document.getElementById('confirmPassword').value = '';

      } catch (error) {
        console.error('비밀번호 변경 실패:', error);
        passwordResult.innerHTML = `<div class="error">❌ 변경 실패: ${error.message}</div>`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '🔒 비밀번호 변경';
      }
    });

    // 계정 삭제 확인
    window.confirmAccountDeletion = function() {
      const confirmText = '정말로 계정을 삭제하시겠습니까?\n\n이 작업은 되돌릴 수 없으며, 모든 데이터가 영구적으로 삭제됩니다.\n\n계속하려면 "삭제"를 입력해주세요.';
      const userInput = prompt(confirmText);
      
      if (userInput === '삭제') {
        deleteAccount();
      } else if (userInput !== null) {
        alert('입력이 올바르지 않습니다. 계정 삭제가 취소되었습니다.');
      }
    };

    // 계정 삭제 실행
    async function deleteAccount() {
      try {
        // 관련 데이터 삭제는 CASCADE로 자동 처리됨
        const { error } = await supabase.auth.admin.deleteUser(user.id);
        
        if (error) throw error;
        
        alert('계정이 삭제되었습니다. 메인 페이지로 이동합니다.');
        location.href = 'index.html';
        
      } catch (error) {
        console.error('계정 삭제 실패:', error);
        alert('계정 삭제 실패: ' + error.message);
      }
    }

    // 토스트 메시지
    function showToast(message) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white; padding: 12px 24px; border-radius: 12px;
        z-index: 9999; font-weight: 600; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        animation: slideDown 0.3s ease;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // 초기 로드
    await loadProfile();
    await checkLineConnection();
  </script>
</body>
</html>
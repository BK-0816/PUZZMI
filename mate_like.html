
<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>메이트 프로필 - PUZZMI</title>
<link rel="stylesheet" href="styles.css"/><link rel="stylesheet" href="pages.css"/><link rel="stylesheet" href="nav.css"/><link rel="stylesheet" href="pages-theme.css"/>
<script type="module" src="nav.js"></script></head>
<body class="bg-cream"><div id="app-nav"></div><main class="page"><section class="row">
<aside class="card"><img id="avatar" style="width:100%;height:320px;object-fit:cover;border-radius:12px"/><div class="spacer"></div><a id="bookBtn" class="btn btn-primary" href="#">이 메이트로 예약하기</a><button id="favBtn" class="btn btn-secondary">♡ 찜하기</button></aside>
<article class="card"><h2 id="name">메이트 이름</h2><div class="muted" id="meta"></div><div id="bio" class="spacer"></div><h3 class="label">MBTI & 취미</h3><div class="chips" id="chips"></div><div class="spacer"></div><h3 class="label">언어</h3><div class="chips" id="langs"></div></article>
</section></main>
<script type="module">
import { supabase } from './nav.js';
const params=new URLSearchParams(location.search); const mateId=params.get('mate_id'); const favBtn=document.getElementById('favBtn');
async function loadMate(){const {data}=await supabase.from('mate_profiles').select(`user_id,bio,hourly_rate,mbti,hobbies,rating,profiles!inner(id,full_name,age,gender,languages,avatar_url)`).eq('user_id', mateId).single();
const p=data?.profiles||{}; document.getElementById('avatar').src=p.avatar_url||"https://picsum.photos/seed/puzzmi/600/400"; document.getElementById('name').textContent=p.full_name||'이름 비공개';
const age=p.age?`${p.age}세`:''; const gender=p.gender||''; const mbti=data.mbti?` • MBTI ${data.mbti}`:''; document.getElementById('meta').textContent=[age,gender].filter(Boolean).join(' • ')+mbti;
document.getElementById('bio').textContent=data.bio||''; document.getElementById('chips').innerHTML=(data.hobbies||[]).map(t=>`<span class="chip">${t}</span>`).join(''); document.getElementById('langs').innerHTML=(p.languages||[]).map(l=>`<span class="chip">${l}</span>`).join(''); document.getElementById('bookBtn').href=`booking.html?mate_id=${data.user_id}`;}
async function syncFav(){const {data:{user}}=await supabase.auth.getUser(); if(!user){favBtn.textContent='♡ 찜하기 (로그인 필요)'; return;} const {data}=await supabase.from('favorites').select('*').eq('user_id', user.id).eq('mate_id', mateId).maybeSingle(); favBtn.textContent=data?'♥ 찜해제':'♡ 찜하기';}
favBtn.onclick=async()=>{const {data:{user}}=await supabase.auth.getUser(); if(!user) return location.href='auth.html?redirect='+encodeURIComponent(location.pathname+location.search);
const {data}=await supabase.from('favorites').select('*').eq('user_id', user.id).eq('mate_id', mateId).maybeSingle(); if(data){await supabase.from('favorites').delete().eq('user_id', user.id).eq('mate_id', mateId);} else {await supabase.from('favorites').insert({user_id:user.id, mate_id:mateId});} syncFav();};
loadMate(); syncFav();
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
  const SUPABASE_URL = "https://eevvgbbokenpjnvtmztk.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVldnZnYmJva2VucGpudnRtenRrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NjI2OTgsImV4cCI6MjA3MzEzODY5OH0.aLoqYYeDW_0ZEwkr8c8IPFvXnEwQPZah1mQzwiyG2Y4";
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    const redir = encodeURIComponent(location.pathname + location.search);
    location.replace(`auth_combo.html?redirect=${redir}`);
  }
</script></body></html>
